<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Baccarat ‚Äî Royal Table</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Cormorant+Garamond:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --gold: #c9a84c;
    --gold-light: #e8d08a;
    --gold-dark: #8b6914;
    --green: #0a3d2e;
    --green-felt: #0d4d38;
    --green-light: #1a6b52;
    --dark: #0a0a0a;
    --darker: #050505;
    --card-bg: #faf8f0;
    --text: #e8e0d0;
    --red: #c0392b;
    --black: #1a1a1a;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Cormorant Garamond', serif;
    background: var(--darker);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 1000;
    opacity: 0.4;
  }

  /* TOP BAR */
  .top-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 20px;
    background: rgba(0,0,0,0.5);
    border-bottom: 1px solid rgba(201,168,76,0.1);
    position: sticky;
    top: 0;
    z-index: 500;
    backdrop-filter: blur(8px);
    gap: 10px;
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    color: rgba(201,168,76,0.6);
    text-decoration: none;
    font-size: 0.75rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    transition: color 0.2s;
    font-family: 'Cormorant Garamond', serif;
    -webkit-tap-highlight-color: transparent;
    white-space: nowrap;
  }
  .back-link:hover { color: var(--gold); }
  .back-link svg { transition: transform 0.2s; flex-shrink: 0; }
  .back-link:hover svg { transform: translateX(-3px); }

  .top-bar-title {
    font-size: 0.65rem;
    letter-spacing: 5px;
    text-transform: uppercase;
    color: rgba(201,168,76,0.3);
    white-space: nowrap;
  }

  .top-bar-right { display: flex; align-items: center; gap: 8px; }

  .audio-btn {
    background: none;
    border: 1px solid rgba(201,168,76,0.4);
    border-radius: 6px;
    color: var(--gold-light);
    font-size: 0.75rem;
    padding: 4px 8px;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
    font-family: 'Cormorant Garamond', serif;
  }
  .audio-btn:hover { background: rgba(201,168,76,0.1); border-color: var(--gold); }

  .top-bar-balance {
    display: flex;
    align-items: center;
    gap: 6px;
    background: rgba(201,168,76,0.07);
    border: 1px solid rgba(201,168,76,0.2);
    padding: 5px 12px;
    white-space: nowrap;
    cursor: pointer;
    transition: all 0.2s;
    -webkit-tap-highlight-color: transparent;
  }
  .top-bar-balance:hover { background: rgba(201,168,76,0.13); border-color: rgba(201,168,76,0.4); }
  .top-bar-balance .tbl-label { font-size: 0.6rem; letter-spacing: 3px; text-transform: uppercase; color: rgba(201,168,76,0.45); }
  .top-bar-balance .tbl-amount { font-family: 'Playfair Display', serif; font-size: 0.95rem; color: var(--gold); }

  @media (max-width: 580px) {
    .top-bar { padding: 8px 10px; }
    .top-bar-title { display: none; }
    .top-bar-balance .tbl-label { display: none; }
    .top-bar-balance { padding: 5px 8px; }
    .audio-btn { font-size: 0.68rem; padding: 3px 6px; }
  }
  @media (max-width: 360px) { .back-link span { display: none; } }

  /* BALANCE MODAL */
  .balance-modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    z-index: 2000;
    align-items: flex-start;
    justify-content: flex-end;
    padding: 64px 16px 0 0;
    backdrop-filter: blur(4px);
  }
  .balance-modal-overlay.open { display: flex; }

  .balance-modal {
    background: #0d0d0d;
    border: 1px solid rgba(201,168,76,0.3);
    width: 340px;
    max-width: calc(100vw - 24px);
    box-shadow: 0 20px 60px rgba(0,0,0,0.8);
    animation: slideDown 0.25s ease;
    position: relative;
    overflow: hidden;
  }
  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-16px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .balance-modal::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
  }

  .bm-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 18px 20px 14px;
    border-bottom: 1px solid rgba(201,168,76,0.12);
  }
  .bm-title { font-family: 'Playfair Display', serif; color: var(--gold); font-size: 1.1rem; letter-spacing: 3px; }
  .bm-close { background: none; border: none; color: rgba(201,168,76,0.5); font-size: 1.3rem; cursor: pointer; padding: 4px; transition: color 0.2s; }
  .bm-close:hover { color: var(--gold); }

  .bm-amount { text-align: center; padding: 24px 20px 18px; border-bottom: 1px solid rgba(201,168,76,0.1); }
  .bm-amount-label { font-size: 0.62rem; letter-spacing: 5px; text-transform: uppercase; color: rgba(201,168,76,0.4); margin-bottom: 8px; }
  .bm-amount-value { font-family: 'Playfair Display', serif; font-size: 2.4rem; color: var(--gold); }

  .bm-add { padding: 16px 20px; border-bottom: 1px solid rgba(201,168,76,0.1); text-align: center; }
  .bm-add-hint { font-size: 0.62rem; letter-spacing: 4px; text-transform: uppercase; color: rgba(201,168,76,0.35); margin-bottom: 10px; }
  .btn-add-funds {
    font-family: 'Cormorant Garamond', serif;
    font-size: 0.95rem; letter-spacing: 3px; text-transform: uppercase;
    padding: 11px 32px;
    background: linear-gradient(135deg, #1a5c30, #27ae60);
    color: #fff; border: none; cursor: pointer; transition: all 0.2s; min-height: 44px;
  }
  .btn-add-funds:hover { transform: translateY(-1px); box-shadow: 0 6px 22px rgba(39,174,96,0.3); }

  .bm-tx-title { font-size: 0.62rem; letter-spacing: 4px; text-transform: uppercase; color: rgba(201,168,76,0.4); padding: 14px 20px 8px; }
  .bm-tx-list { max-height: 220px; overflow-y: auto; scrollbar-width: thin; scrollbar-color: rgba(201,168,76,0.2) transparent; }
  .tx-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; border-bottom: 1px solid rgba(255,255,255,0.03); font-size: 0.88rem; }
  .tx-row:last-child { border-bottom: none; }
  .tx-info-desc { color: rgba(232,224,208,0.65); }
  .tx-info-time { font-size: 0.66rem; color: rgba(201,168,76,0.3); margin-top: 2px; }
  .tx-amount { font-family: 'Playfair Display', serif; font-size: 0.95rem; }
  .tx-amount.credit { color: #2ecc71; }
  .tx-amount.debit  { color: #e74c3c; }
  .bm-empty { text-align: center; padding: 24px; color: rgba(201,168,76,0.3); font-style: italic; }

  /* HEADER */
  header {
    text-align: center;
    padding: clamp(24px, 6vw, 48px) 20px clamp(16px, 4vw, 32px);
    border-bottom: 1px solid rgba(201,168,76,0.3);
  }
  .header-ornament { color: var(--gold); font-size: 14px; letter-spacing: 8px; text-transform: uppercase; opacity: 0.7; margin-bottom: 12px; }
  h1 { font-family: 'Playfair Display', serif; font-size: clamp(2.5rem, 6vw, 5rem); color: var(--gold); letter-spacing: 0.1em; line-height: 1; text-shadow: 0 0 40px rgba(201,168,76,0.3); }
  h1 span { font-style: italic; font-size: 0.6em; display: block; color: var(--gold-light); letter-spacing: 0.3em; margin-top: 6px; }
  .gold-line { width: 120px; height: 1px; background: linear-gradient(90deg, transparent, var(--gold), transparent); margin: 20px auto; }

  /* NAV */
  nav { display: flex; justify-content: center; border-bottom: 1px solid rgba(201,168,76,0.2); overflow-x: auto; scrollbar-width: none; }
  nav::-webkit-scrollbar { display: none; }
  .tab-btn {
    background: none; border: none; color: rgba(232,208,138,0.5);
    font-family: 'Cormorant Garamond', serif; font-size: 1rem; letter-spacing: 4px;
    text-transform: uppercase; padding: 16px 24px; cursor: pointer; position: relative;
    transition: color 0.3s; white-space: nowrap; -webkit-tap-highlight-color: transparent;
  }
  .tab-btn::after { content: ''; position: absolute; bottom: -1px; left: 0; right: 0; height: 2px; background: var(--gold); transform: scaleX(0); transition: transform 0.3s; }
  .tab-btn.active { color: var(--gold); }
  .tab-btn.active::after { transform: scaleX(1); }
  @media (max-width: 480px) { .tab-btn { font-size: 0.85rem; letter-spacing: 2px; padding: 14px 16px; } }

  /* SECTIONS */
  .section { display: none; max-width: 1100px; margin: 0 auto; padding: clamp(20px, 5vw, 40px) clamp(12px, 4vw, 20px); animation: fadeIn 0.4s ease; }
  .section.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  /* GAME */
  .game-wrapper { display: flex; flex-direction: column; align-items: center; gap: 20px; }

  .speed-toggle { display: flex; border: 1px solid rgba(201,168,76,0.25); overflow: hidden; align-self: flex-end; }
  .speed-btn {
    font-family: 'Cormorant Garamond', serif; font-size: 0.75rem; letter-spacing: 3px;
    text-transform: uppercase; padding: 8px 18px; background: none; border: none;
    color: rgba(201,168,76,0.45); cursor: pointer; transition: all 0.2s;
    -webkit-tap-highlight-color: transparent; min-height: 38px;
  }
  .speed-btn.active { background: rgba(201,168,76,0.12); color: var(--gold); }
  .speed-btn + .speed-btn { border-left: 1px solid rgba(201,168,76,0.2); }

  /* Bet area */
  .bet-area {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 16px; align-items: center;
    background: rgba(0,0,0,0.3); border: 1px solid rgba(201,168,76,0.15);
    padding: 16px 20px; width: 100%; max-width: 800px;
  }
  @media (max-width: 600px) {
    .bet-area { grid-template-columns: 1fr 1fr; }
    .bet-input-wrap { grid-column: 1 / -1; order: -1; }
  }

  .balance-display { text-align: center; }
  .balance-label { font-size: 0.7rem; letter-spacing: 4px; text-transform: uppercase; color: rgba(201,168,76,0.6); }
  .balance-amount { font-family: 'Playfair Display', serif; font-size: clamp(1.2rem, 4vw, 1.8rem); color: var(--gold); }

  .bet-input-wrap { display: flex; flex-direction: column; align-items: center; gap: 8px; }
  .bet-input-label { font-size: 0.68rem; letter-spacing: 4px; text-transform: uppercase; color: rgba(201,168,76,0.5); }
  .bet-input-row { display: flex; align-items: center; gap: 6px; }
  .bet-input {
    font-family: 'Playfair Display', serif; font-size: 1.3rem; color: var(--gold);
    background: rgba(201,168,76,0.06); border: 1px solid rgba(201,168,76,0.3);
    padding: 8px 14px; width: 120px; text-align: center; outline: none; transition: border-color 0.2s;
  }
  .bet-input:focus { border-color: var(--gold); }
  .bet-input::placeholder { color: rgba(201,168,76,0.25); font-size: 1rem; }
  .bet-input::-webkit-outer-spin-button, .bet-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  .bet-input[type=number] { -moz-appearance: textfield; }

  .quick-bets { display: flex; gap: 5px; flex-wrap: wrap; justify-content: center; }
  .quick-bet-btn {
    font-family: 'Cormorant Garamond', serif; font-size: 0.72rem; letter-spacing: 1px;
    padding: 5px 10px; background: rgba(201,168,76,0.07); border: 1px solid rgba(201,168,76,0.2);
    color: rgba(201,168,76,0.6); cursor: pointer; transition: all 0.15s; min-height: 30px;
    -webkit-tap-highlight-color: transparent;
  }
  .quick-bet-btn:hover { background: rgba(201,168,76,0.15); color: var(--gold); border-color: rgba(201,168,76,0.5); }

  /* Bet zones */
  .bet-zones {
    display: grid; grid-template-columns: 1fr auto 1fr;
    gap: 10px; width: 100%; max-width: 800px; align-items: stretch;
  }
  @media (max-width: 500px) {
    .bet-zones { grid-template-columns: 1fr 1fr; grid-template-rows: auto auto; }
    .tie-zone { grid-column: 1 / -1; order: 3; }
  }

  .bet-zone {
    padding: 16px; border: 1px solid rgba(201,168,76,0.2);
    text-align: center; cursor: pointer; transition: all 0.2s;
    background: rgba(10,61,46,0.2); position: relative; overflow: hidden;
  }
  .bet-zone:hover { border-color: var(--gold); background: rgba(201,168,76,0.1); }
  .bet-zone.selected { border-color: var(--gold); background: rgba(201,168,76,0.15); box-shadow: 0 0 20px rgba(201,168,76,0.2); }
  .bet-zone-name { font-family: 'Playfair Display', serif; font-size: 1.1rem; color: var(--gold); letter-spacing: 2px; }
  .bet-zone-odds { font-size: 0.75rem; letter-spacing: 3px; color: rgba(201,168,76,0.6); text-transform: uppercase; margin-top: 4px; }
  .bet-zone-amount { font-size: 1.3rem; color: var(--gold-light); margin-top: 8px; min-height: 1.5em; }

  .tie-zone {
    background: rgba(0,0,0,0.3); padding: 12px 8px;
    border: 1px dashed rgba(201,168,76,0.2); text-align: center;
    cursor: pointer; transition: all 0.2s;
  }
  .tie-zone:hover, .tie-zone.selected { border-color: var(--gold); background: rgba(201,168,76,0.1); }

  /* BONUS BETS */
  .bonus-section { width: 100%; max-width: 800px; }
  .bonus-title { font-size: 0.65rem; letter-spacing: 5px; text-transform: uppercase; color: rgba(201,168,76,0.45); text-align: center; margin-bottom: 10px; }
  .bonus-bets { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; }
  .bonus-zone {
    padding: 10px 8px; border: 1px dashed rgba(201,168,76,0.18);
    text-align: center; cursor: pointer; transition: all 0.2s;
    background: rgba(0,0,0,0.25); position: relative;
  }
  .bonus-zone:hover { border-color: rgba(201,168,76,0.5); background: rgba(201,168,76,0.08); }
  .bonus-zone.selected { border-color: #e8d08a; background: rgba(232,208,138,0.1); box-shadow: 0 0 12px rgba(232,208,138,0.15); }
  .bonus-zone-name { font-family: 'Playfair Display', serif; font-size: 0.9rem; color: var(--gold-light); letter-spacing: 1px; }
  .bonus-zone-desc { font-size: 0.65rem; letter-spacing: 2px; color: rgba(201,168,76,0.45); margin-top: 3px; text-transform: uppercase; }
  .bonus-zone-amount { font-size: 1rem; color: var(--gold-light); margin-top: 5px; min-height: 1.2em; }

  .bonus-info-row { display: flex; justify-content: center; margin-top: 6px; }
  .bonus-info-btn {
    font-size: 0.65rem; letter-spacing: 3px; text-transform: uppercase; color: rgba(201,168,76,0.35);
    background: none; border: none; cursor: pointer; padding: 4px 8px; transition: color 0.2s;
    -webkit-tap-highlight-color: transparent;
  }
  .bonus-info-btn:hover { color: rgba(201,168,76,0.7); }

  /* Bonus modal */
  .bonus-modal-overlay {
    display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8);
    z-index: 3000; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(4px);
  }
  .bonus-modal-overlay.open { display: flex; }
  .bonus-modal {
    background: #0e0e0e; border: 1px solid rgba(201,168,76,0.3);
    width: 100%; max-width: 560px; max-height: 85vh; overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.9); animation: fadeIn 0.2s ease; position: relative;
  }
  .bonus-modal::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, var(--gold), transparent); }
  .bm2-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 18px 22px 14px; border-bottom: 1px solid rgba(201,168,76,0.12);
    position: sticky; top: 0; background: #0e0e0e; z-index: 1;
  }
  .bm2-title { font-family: 'Playfair Display', serif; color: var(--gold); font-size: 1.15rem; letter-spacing: 3px; }
  .bm2-close { background: none; border: none; color: rgba(201,168,76,0.5); font-size: 1.4rem; cursor: pointer; padding: 4px; transition: color 0.2s; }
  .bm2-close:hover { color: var(--gold); }
  .bonus-table { width: 100%; border-collapse: collapse; }
  .bonus-table th { color: rgba(201,168,76,0.55); font-size: 0.65rem; letter-spacing: 3px; text-transform: uppercase; padding: 10px 16px; text-align: left; border-bottom: 1px solid rgba(201,168,76,0.15); }
  .bonus-table td { padding: 9px 16px; color: rgba(232,224,208,0.75); font-size: 0.9rem; border-bottom: 1px solid rgba(255,255,255,0.04); vertical-align: top; }
  .bonus-table tr:last-child td { border-bottom: none; }
  .bonus-hand { color: var(--gold-light); font-family: 'Playfair Display', serif; font-size: 0.95rem; }
  .bonus-pay { color: #e8d08a; font-weight: 500; }

  /* FELT TABLE */
  .felt-table {
    width: 100%; max-width: 800px;
    background: var(--green-felt);
    border: 3px solid var(--gold-dark);
    box-shadow: 0 0 60px rgba(0,0,0,0.8), inset 0 0 80px rgba(0,0,0,0.2);
    padding: clamp(14px, 4vw, 28px);
    position: relative; border-radius: 4px; overflow: hidden;
  }
  .felt-table::before {
    content: ''; position: absolute; inset: 6px;
    border: 1px solid rgba(201,168,76,0.2); pointer-events: none;
  }

  .hand-row { display: flex; justify-content: space-between; gap: 12px; margin-bottom: 16px; }
  .hand-area { flex: 1; text-align: center; min-width: 0; }
  .hand-label {
    font-family: 'Playfair Display', serif;
    font-size: clamp(0.6rem, 2vw, 0.75rem); letter-spacing: clamp(2px, 1vw, 5px);
    text-transform: uppercase; color: rgba(201,168,76,0.7); margin-bottom: 10px;
  }
  .cards-row {
    display: flex; gap: clamp(6px, 2vw, 10px); justify-content: center;
    min-height: clamp(76px, 18vw, 100px); align-items: center; flex-wrap: nowrap; overflow: visible;
  }
  .score-display { margin-top: 10px; font-family: 'Playfair Display', serif; font-size: 1.6rem; color: var(--gold); }

  /* CARDS */
  .playing-card {
    width: clamp(52px, 12vw, 68px); height: clamp(76px, 17vw, 100px);
    background: var(--card-bg); border-radius: 5px;
    box-shadow: 2px 4px 12px rgba(0,0,0,0.5);
    position: relative; display: flex; align-items: center; justify-content: center;
    flex-direction: column; font-size: clamp(0.75rem, 2.5vw, 1.1rem); font-weight: 700;
    animation: dealCard var(--deal-duration, 0.3s) ease;
    transform-origin: bottom center; flex-shrink: 0;
  }
  @keyframes dealCard {
    from { opacity: 0; transform: scale(0.5) rotate(-5deg) translateY(-20px); }
    to   { opacity: 1; transform: scale(1) rotate(0deg) translateY(0); }
  }
  .card-corner-top { position: absolute; top: 4px; left: 5px; font-size: clamp(0.6rem, 1.8vw, 0.85rem); line-height: 1; }
  .card-corner-bottom { position: absolute; bottom: 4px; right: 5px; font-size: clamp(0.6rem, 1.8vw, 0.85rem); line-height: 1; transform: rotate(180deg); }
  .card-suit-center { font-size: clamp(1.2rem, 4vw, 1.8rem); }
  .card-red { color: var(--red); }
  .card-black { color: #1a1a1a; }

  /* RESULT */
  .result-msg {
    text-align: center; padding: 16px;
    background: rgba(0,0,0,0.5); border: 1px solid rgba(201,168,76,0.3);
    min-height: 58px; display: flex; align-items: center; justify-content: center;
  }
  .result-text { font-family: 'Playfair Display', serif; font-size: 1.3rem; color: var(--gold); letter-spacing: 2px; animation: fadeIn 0.5s ease; }
  .result-win { color: #2ecc71; text-shadow: 0 0 20px rgba(46,204,113,0.5); }
  .result-loss { color: #e74c3c; }
  .result-tie { color: var(--gold); }

  /* ROAD MAP */
  .road-under { width: 100%; max-width: 800px; }
  .road-under-label { font-size: 0.62rem; letter-spacing: 5px; text-transform: uppercase; color: rgba(201,168,76,0.4); margin-bottom: 8px; text-align: center; }
  .road-map { display: flex; flex-wrap: wrap; gap: 5px; padding: 12px 14px; background: rgba(0,0,0,0.2); border: 1px solid rgba(201,168,76,0.1); min-height: 46px; }
  .road-dot { width: 26px; height: 26px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.62rem; font-weight: 700; }
  .road-P { background: rgba(41,128,185,0.3); border: 2px solid #2980b9; color: #2980b9; }
  .road-B { background: rgba(192,57,43,0.3); border: 2px solid #c0392b; color: #c0392b; }
  .road-T { background: rgba(201,168,76,0.2); border: 2px solid var(--gold); color: var(--gold); }

  /* ACTIONS */
  .action-row { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; width: 100%; max-width: 800px; }

  .btn-primary {
    font-family: 'Cormorant Garamond', serif; font-size: 1rem; letter-spacing: 4px;
    text-transform: uppercase; padding: 14px 32px;
    background: linear-gradient(135deg, var(--gold-dark), var(--gold));
    color: var(--darker); border: none; cursor: pointer; transition: all 0.2s; font-weight: 600;
    box-shadow: 0 4px 20px rgba(201,168,76,0.3); touch-action: manipulation;
    -webkit-tap-highlight-color: transparent; min-height: 48px;
  }
  .btn-secondary {
    font-family: 'Cormorant Garamond', serif; font-size: 1rem; letter-spacing: 4px;
    text-transform: uppercase; padding: 14px 20px; background: transparent;
    color: var(--gold); border: 1px solid rgba(201,168,76,0.4); cursor: pointer;
    transition: all 0.2s; touch-action: manipulation; -webkit-tap-highlight-color: transparent; min-height: 48px;
  }
  .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 28px rgba(201,168,76,0.4); }
  .btn-primary:disabled { opacity: 0.3; cursor: not-allowed; transform: none; }
  .btn-secondary:hover { background: rgba(201,168,76,0.1); border-color: var(--gold); }

  /* STATS */
  .section-title { font-family: 'Playfair Display', serif; color: var(--gold); font-size: 2rem; text-align: center; letter-spacing: 3px; }
  .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 16px; margin-bottom: 32px; }
  .stat-card { background: linear-gradient(135deg, rgba(10,61,46,0.3), rgba(0,0,0,0.3)); border: 1px solid rgba(201,168,76,0.2); padding: 24px 16px; text-align: center; position: relative; }
  .stat-card::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, var(--gold), transparent); }
  .stat-value { font-family: 'Playfair Display', serif; font-size: 2.2rem; color: var(--gold); display: block; }
  .stat-label { font-size: 0.7rem; letter-spacing: 4px; text-transform: uppercase; color: rgba(201,168,76,0.5); margin-top: 6px; display: block; }

  .history-title { font-family: 'Playfair Display', serif; color: var(--gold); font-size: 1.3rem; letter-spacing: 3px; margin-bottom: 16px; text-align: center; }
  .win-bar-wrap { margin-bottom: 32px; }
  .win-bar-labels { display: flex; justify-content: space-between; font-size: 0.75rem; letter-spacing: 3px; color: rgba(201,168,76,0.5); text-transform: uppercase; margin-bottom: 8px; }
  .win-bar-track { height: 8px; background: rgba(255,255,255,0.05); border-radius: 4px; overflow: hidden; display: flex; }
  .win-bar-player { background: #2980b9; transition: width 0.5s; }
  .win-bar-banker { background: #c0392b; transition: width 0.5s; }
  .win-bar-tie { background: var(--gold-dark); transition: width 0.5s; }

  .history-table-wrap { overflow-x: auto; border: 1px solid rgba(201,168,76,0.1); }
  .history-table { width: 100%; min-width: 480px; border-collapse: collapse; font-size: 0.95rem; }
  .history-table th { color: rgba(201,168,76,0.6); font-size: 0.7rem; letter-spacing: 3px; text-transform: uppercase; padding: 10px 14px; border-bottom: 1px solid rgba(201,168,76,0.2); text-align: left; }
  .history-table td { padding: 10px 14px; border-bottom: 1px solid rgba(255,255,255,0.04); color: rgba(232,224,208,0.8); }
  .history-table tr:hover td { background: rgba(201,168,76,0.04); }
  .pill { display: inline-block; padding: 2px 10px; border-radius: 2px; font-size: 0.8rem; letter-spacing: 1px; }
  .pill-win { background: rgba(46,204,113,0.15); color: #2ecc71; }
  .pill-loss { background: rgba(231,76,60,0.15); color: #e74c3c; }
  .pill-tie { background: rgba(201,168,76,0.15); color: var(--gold); }
  .empty-history { text-align: center; padding: 40px; color: rgba(201,168,76,0.3); font-style: italic; font-size: 1.1rem; }

  .reset-btn {
    display: block; margin: 20px auto 0; background: none; border: 1px solid rgba(192,57,43,0.3);
    color: rgba(192,57,43,0.6); font-family: 'Cormorant Garamond', serif; letter-spacing: 3px;
    font-size: 0.8rem; text-transform: uppercase; padding: 8px 24px; cursor: pointer; transition: all 0.2s;
  }
  .reset-btn:hover { border-color: #c0392b; color: #c0392b; }

  /* RULES */
  .rules-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 32px; margin-top: 32px; }
  @media (max-width: 700px) { .rules-grid { grid-template-columns: 1fr; } }
  .rule-card { background: linear-gradient(135deg, rgba(201,168,76,0.05), rgba(10,61,46,0.2)); border: 1px solid rgba(201,168,76,0.2); padding: 28px; position: relative; overflow: hidden; }
  .rule-card::before { content: ''; position: absolute; top: 0; left: 0; width: 3px; height: 100%; background: linear-gradient(180deg, var(--gold), transparent); }
  .rule-card h3 { font-family: 'Playfair Display', serif; color: var(--gold); font-size: 1.2rem; margin-bottom: 16px; letter-spacing: 2px; }
  .rule-card p, .rule-card li { font-size: 1rem; line-height: 1.8; color: rgba(232,224,208,0.85); font-weight: 300; }
  .rule-card ul { padding-left: 20px; }
  .rule-card li { margin-bottom: 6px; }
  .card-values-table { width: 100%; border-collapse: collapse; margin-top: 16px; }
  .card-values-table th { color: var(--gold); font-family: 'Playfair Display', serif; font-size: 0.85rem; letter-spacing: 2px; text-transform: uppercase; padding: 10px 14px; border-bottom: 1px solid rgba(201,168,76,0.3); text-align: left; }
  .card-values-table td { padding: 8px 14px; color: rgba(232,224,208,0.8); font-size: 0.95rem; border-bottom: 1px solid rgba(255,255,255,0.05); }

  /* FOOTER */
  .games-footer { margin-top: 60px; border-top: 1px solid rgba(201,168,76,0.15); padding: 36px 20px 48px; }
  .games-footer-title { text-align: center; font-size: 0.7rem; letter-spacing: 6px; text-transform: uppercase; color: rgba(201,168,76,0.4); margin-bottom: 24px; }
  .games-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; max-width: 700px; margin: 0 auto; }
  @media (max-width: 500px) { .games-grid { grid-template-columns: 1fr; max-width: 300px; } }
  .game-card-link { display: block; text-decoration: none; border: 1px solid rgba(201,168,76,0.15); padding: 20px 12px; text-align: center; transition: all 0.25s; position: relative; overflow: hidden; background: rgba(0,0,0,0.2); -webkit-tap-highlight-color: transparent; }
  .game-card-link::before { content: ''; position: absolute; inset: 0; background: linear-gradient(135deg, rgba(201,168,76,0.05), transparent); opacity: 0; transition: opacity 0.25s; }
  .game-card-link:hover { border-color: rgba(201,168,76,0.5); transform: translateY(-3px); box-shadow: 0 8px 30px rgba(0,0,0,0.4); }
  .game-card-link:hover::before { opacity: 1; }
  .game-card-icon { font-size: 2rem; display: block; margin-bottom: 8px; }
  .game-card-name { font-family: 'Playfair Display', serif; font-size: 1rem; color: rgba(201,168,76,0.8); letter-spacing: 2px; display: block; }
  .game-card-sub { font-size: 0.65rem; letter-spacing: 3px; text-transform: uppercase; color: rgba(201,168,76,0.35); display: block; margin-top: 4px; }

  /* TOAST */
  .toast {
    position: fixed; bottom: 30px; left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: rgba(10,10,10,0.95); border: 1px solid rgba(201,168,76,0.4);
    color: var(--gold); font-family: 'Playfair Display', serif; font-size: 1rem;
    letter-spacing: 2px; padding: 14px 24px; z-index: 9999;
    transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    max-width: calc(100vw - 40px); text-align: center;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }
</style>
</head>
<body>

<!-- BALANCE MODAL -->
<div class="balance-modal-overlay" id="balanceModalOverlay" onclick="closeBalanceModalOnBg(event)">
  <div class="balance-modal">
    <div class="bm-header"><span class="bm-title">–ë–∞–ª–∞–Ω—Å</span><button class="bm-close" onclick="closeBalanceModal()">‚úï</button></div>
    <div class="bm-amount"><div class="bm-amount-label">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å</div><div class="bm-amount-value" id="bmAmount">‚ÇΩ ‚Äî</div></div>
    <div class="bm-add"><div class="bm-add-hint">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</div><button class="btn-add-funds" onclick="addFunds()">+ 10 000</button></div>
    <div class="bm-tx-title">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</div>
    <div class="bm-tx-list" id="bmTxList"><div class="bm-empty">–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</div></div>
  </div>
</div>

<!-- BONUS INFO MODAL -->
<div class="bonus-modal-overlay" id="bonusModalOverlay" onclick="closeBonusModalOnBg(event)">
  <div class="bonus-modal">
    <div class="bm2-header"><span class="bm2-title">–ë–æ–Ω—É—Å–Ω—ã–µ —Å—Ç–∞–≤–∫–∏</span><button class="bm2-close" onclick="closeBonusModal()">‚úï</button></div>
    <div style="padding: 20px;">
      <p style="font-size:0.9rem; color:rgba(232,224,208,0.65); line-height:1.7; margin-bottom:20px;">–ë–æ–Ω—É—Å–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–æ–∫–æ–≤—ã–µ —Å—Ç–∞–≤–∫–∏, –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏—Å—Ö–æ–¥–∞.</p>
      <p style="font-family:'Playfair Display',serif; color:var(--gold); margin-bottom:10px; letter-spacing:2px;">üêº Panda 8</p>
      <table class="bonus-table" style="margin-bottom:20px;"><tr><th>–†—É–∫–∞</th><th>–í—ã–ø–ª–∞—Ç–∞</th></tr><tr><td class="bonus-hand">–ë–∞–Ω–∫–∏—Ä 3 –∫–∞—Ä—Ç—ã = 8</td><td class="bonus-pay">25:1</td></tr></table>
      <p style="font-family:'Playfair Display',serif; color:var(--gold); margin-bottom:10px; letter-spacing:2px;">üêâ Dragon Bonus</p>
      <table class="bonus-table" style="margin-bottom:20px;"><tr><th>–£—Å–ª–æ–≤–∏–µ</th><th>–í—ã–ø–ª–∞—Ç–∞</th></tr><tr><td class="bonus-hand">–ù–∞—Ç—É—Ä–∞–ª –ø–æ–±–µ–¥–∏—Ç–µ–ª—å</td><td class="bonus-pay">1:1</td></tr><tr><td class="bonus-hand">–ü–æ–±–µ–¥–∞ —Å –ø–µ—Ä–µ–≤–µ—Å–æ–º 9</td><td class="bonus-pay">30:1</td></tr><tr><td class="bonus-hand">–ü–æ–±–µ–¥–∞ —Å –ø–µ—Ä–µ–≤–µ—Å–æ–º 8</td><td class="bonus-pay">10:1</td></tr><tr><td class="bonus-hand">–ü–æ–±–µ–¥–∞ —Å –ø–µ—Ä–µ–≤–µ—Å–æ–º 7</td><td class="bonus-pay">6:1</td></tr><tr><td class="bonus-hand">–ü–æ–±–µ–¥–∞ —Å –ø–µ—Ä–µ–≤–µ—Å–æ–º 6</td><td class="bonus-pay">4:1</td></tr><tr><td class="bonus-hand">–ü–æ–±–µ–¥–∞ —Å –ø–µ—Ä–µ–≤–µ—Å–æ–º 5</td><td class="bonus-pay">2:1</td></tr><tr><td class="bonus-hand">–ü–æ–±–µ–¥–∞ —Å –ø–µ—Ä–µ–≤–µ—Å–æ–º 4</td><td class="bonus-pay">1:1</td></tr></table>
      <p style="font-family:'Playfair Display',serif; color:var(--gold); margin-bottom:10px; letter-spacing:2px;">üëë Either Pair</p>
      <table class="bonus-table" style="margin-bottom:20px;"><tr><th>–£—Å–ª–æ–≤–∏–µ</th><th>–í—ã–ø–ª–∞—Ç–∞</th></tr><tr><td class="bonus-hand">–õ—é–±–∞—è –ø–∞—Ä–∞ –≤ –ø–µ—Ä–≤—ã—Ö 2 –∫–∞—Ä—Ç–∞—Ö</td><td class="bonus-pay">5:1</td></tr></table>
      <p style="font-family:'Playfair Display',serif; color:var(--gold); margin-bottom:10px; letter-spacing:2px;">üÉè Perfect Pair</p>
      <table class="bonus-table"><tr><th>–£—Å–ª–æ–≤–∏–µ</th><th>–í—ã–ø–ª–∞—Ç–∞</th></tr><tr><td class="bonus-hand">–ò–¥–µ–∞–ª—å–Ω–∞—è –ø–∞—Ä–∞ (–æ–¥–Ω–∞ –º–∞—Å—Ç—å)</td><td class="bonus-pay">25:1</td></tr><tr><td class="bonus-hand">–ü–∞—Ä–∞ —Ä–∞–∑–Ω—ã—Ö –º–∞—Å—Ç–µ–π</td><td class="bonus-pay">8:1</td></tr></table>
    </div>
  </div>
</div>

<div class="top-bar">
  <a href="index.html" class="back-link">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
    <span>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</span>
  </a>
  <span class="top-bar-title">Royal Casino</span>
  <div class="top-bar-right">
    <button id="sfx-btn" class="audio-btn" onclick="toggleSfx()">üîä –≠—Ñ—Ñ–µ–∫—Ç—ã</button>
    <button id="music-btn" class="audio-btn" onclick="toggleMusic()">üéµ –ú—É–∑—ã–∫–∞</button>
    <div class="top-bar-balance" onclick="openBalanceModal()">
      <span class="tbl-label">–ë–∞–ª–∞–Ω—Å</span>
      <span class="tbl-amount" id="topbar-balance">‚ÇΩ ‚Äî</span>
    </div>
  </div>
</div>

<header>
  <div class="header-ornament">‚ú¶ &nbsp; Royal Casino &nbsp; ‚ú¶</div>
  <h1>BACCARAT<span>Royal Table</span></h1>
  <div class="gold-line"></div>
</header>

<nav>
  <button class="tab-btn active" onclick="showTab('game', this)">–ò–≥—Ä–∞</button>
  <button class="tab-btn" onclick="showTab('rules', this)">–ü—Ä–∞–≤–∏–ª–∞</button>
  <button class="tab-btn" onclick="showTab('stats', this)">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
</nav>

<!-- ========== GAME TAB ========== -->
<div id="tab-game" class="section active">
  <div class="game-wrapper">

    <div class="speed-toggle">
      <button class="speed-btn" id="speed-slow" onclick="setSpeed('slow')">üïê –ú–µ–¥–ª–µ–Ω–Ω–æ</button>
      <button class="speed-btn active" id="speed-fast" onclick="setSpeed('fast')">‚ö° –ë—ã—Å—Ç—Ä–æ</button>
    </div>

    <div class="bet-area">
      <div class="balance-display">
        <div class="balance-label">–ë–∞–ª–∞–Ω—Å</div>
        <div class="balance-amount" id="balance">‚ÇΩ 10,000</div>
      </div>
      <div class="bet-input-wrap">
        <div class="bet-input-label">–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ (‚ÇΩ)</div>
        <div class="bet-input-row">
          <input class="bet-input" type="number" id="betInput" min="10" max="100000" placeholder="0" />
        </div>
        <div class="quick-bets">
          <button class="quick-bet-btn" onclick="setQuickBet(100)">100</button>
          <button class="quick-bet-btn" onclick="setQuickBet(250)">250</button>
          <button class="quick-bet-btn" onclick="setQuickBet(500)">500</button>
          <button class="quick-bet-btn" onclick="setQuickBet(1000)">1K</button>
          <button class="quick-bet-btn" onclick="setQuickBet(5000)">5K</button>
          <button class="quick-bet-btn" onclick="setBetMax()">MAX</button>
        </div>
      </div>
      <div class="balance-display">
        <div class="balance-label">–ú–∏–Ω / –ú–∞–∫—Å</div>
        <div class="balance-amount" style="font-size:1rem; opacity:0.7;">‚ÇΩ10 / ‚ÇΩ50K</div>
      </div>
    </div>

    <div class="bet-zones">
      <div class="bet-zone" id="zone-player" onclick="selectZone('player')">
        <div class="bet-zone-name">–ò–≥—Ä–æ–∫</div>
        <div class="bet-zone-odds">1:1</div>
        <div class="bet-zone-amount" id="bet-player">‚Äî</div>
      </div>
      <div class="tie-zone" id="zone-tie" onclick="selectZone('tie')">
        <div class="bet-zone-name" style="font-size:0.9rem;">–ù–∏—á—å—è</div>
        <div class="bet-zone-odds">8:1</div>
        <div class="bet-zone-amount" id="bet-tie" style="font-size:1.1rem;">‚Äî</div>
      </div>
      <div class="bet-zone" id="zone-banker" onclick="selectZone('banker')">
        <div class="bet-zone-name">–ë–∞–Ω–∫–∏—Ä</div>
        <div class="bet-zone-odds">0.95:1</div>
        <div class="bet-zone-amount" id="bet-banker">‚Äî</div>
      </div>
    </div>

    <div class="bonus-section">
      <div class="bonus-title">‚ú¶ –ë–æ–Ω—É—Å–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ ‚ú¶</div>
      <div class="bonus-bets">
        <div class="bonus-zone" id="bzone-panda" onclick="selectBonusZone('panda')"><div class="bonus-zone-name">üêº Panda 8</div><div class="bonus-zone-desc">–ë–∞–Ω–∫–∏—Ä 3 –∫–∞—Ä—Ç—ã = 8</div><div class="bonus-zone-amount" id="bbet-panda">‚Äî</div></div>
        <div class="bonus-zone" id="bzone-dragon-p" onclick="selectBonusZone('dragon-p')"><div class="bonus-zone-name">üêâ Dragon ‚Äî –ò–≥—Ä–æ–∫</div><div class="bonus-zone-desc">–ü–æ–±–µ–¥–∞ —Å –æ—Ç—Ä—ã–≤–æ–º</div><div class="bonus-zone-amount" id="bbet-dragon-p">‚Äî</div></div>
        <div class="bonus-zone" id="bzone-dragon-b" onclick="selectBonusZone('dragon-b')"><div class="bonus-zone-name">üêâ Dragon ‚Äî –ë–∞–Ω–∫–∏—Ä</div><div class="bonus-zone-desc">–ü–æ–±–µ–¥–∞ —Å –æ—Ç—Ä—ã–≤–æ–º</div><div class="bonus-zone-amount" id="bbet-dragon-b">‚Äî</div></div>
        <div class="bonus-zone" id="bzone-either-pair" onclick="selectBonusZone('either-pair')"><div class="bonus-zone-name">üëë Either Pair</div><div class="bonus-zone-desc">–õ—é–±–∞—è –ø–∞—Ä–∞ √ó 5</div><div class="bonus-zone-amount" id="bbet-either-pair">‚Äî</div></div>
        <div class="bonus-zone" id="bzone-perfect-pair" onclick="selectBonusZone('perfect-pair')"><div class="bonus-zone-name">üÉè Perfect Pair</div><div class="bonus-zone-desc">–ò–¥–µ–∞–ª—å–Ω–∞—è –ø–∞—Ä–∞ √ó 25</div><div class="bonus-zone-amount" id="bbet-perfect-pair">‚Äî</div></div>
      </div>
      <div class="bonus-info-row"><button class="bonus-info-btn" onclick="openBonusModal()">‚Ñπ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –±–æ–Ω—É—Å–Ω—ã–µ —Å—Ç–∞–≤–∫–∏?</button></div>
    </div>

    <div class="felt-table">
      <div class="hand-row">
        <div class="hand-area">
          <div class="hand-label">–ò–≥—Ä–æ–∫</div>
          <div class="cards-row" id="player-cards"></div>
          <div class="score-display" id="player-score"></div>
        </div>
        <div style="width:1px;background:rgba(201,168,76,0.15);"></div>
        <div class="hand-area">
          <div class="hand-label">–ë–∞–Ω–∫–∏—Ä</div>
          <div class="cards-row" id="banker-cards"></div>
          <div class="score-display" id="banker-score"></div>
        </div>
      </div>
      <div class="result-msg" id="result-msg">
        <span class="result-text" style="color:rgba(201,168,76,0.4); font-style:italic;">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–≤–∫—É –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–†–∞–∑–¥–∞—Ç—å¬ª</span>
      </div>
    </div>

    <div class="road-under">
      <div class="road-under-label">–î–æ—Ä–æ–∂–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</div>
      <div class="road-map" id="road-map-game"></div>
    </div>

    <div class="action-row">
      <button class="btn-secondary" onclick="clearBet()">–°–±—Ä–æ—Å</button>
      <button class="btn-primary" id="deal-btn" onclick="deal()">–†–∞–∑–¥–∞—Ç—å –∫–∞—Ä—Ç—ã</button>
      <button class="btn-secondary" id="rebet-btn" onclick="rebet()" disabled>–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
    </div>

  </div>
</div>

<!-- ========== RULES TAB ========== -->
<div id="tab-rules" class="section">
  <div class="section-title">–ü—Ä–∞–≤–∏–ª–∞ –ë–∞–∫–∫–∞—Ä–∞</div>
  <div class="gold-line"></div>
  <div class="rules-grid">
    <div class="rule-card" style="grid-column: 1 / -1;"><h3>–¶–µ–ª—å –∏–≥—Ä—ã</h3><p>–ë–∞–∫–∫–∞—Ä–∞ ‚Äî –∫–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞, –≥–¥–µ –≤—ã –¥–µ–ª–∞–µ—Ç–µ —Å—Ç–∞–≤–∫—É –Ω–∞ —Ç–æ, —á—å—è —Ä—É–∫–∞ –æ–∫–∞–∂–µ—Ç—Å—è –±–ª–∏–∂–µ –∫ <strong style="color:var(--gold)">9</strong> –æ—á–∫–∞–º: —Ä—É–∫–∞ –ò–≥—Ä–æ–∫–∞, —Ä—É–∫–∞ –ë–∞–Ω–∫–∏—Ä–∞ –∏–ª–∏ –ù–∏—á—å—è.</p></div>
    <div class="rule-card"><h3>–°—Ç–æ–∏–º–æ—Å—Ç—å –∫–∞—Ä—Ç</h3><table class="card-values-table"><tr><th>–ö–∞—Ä—Ç–∞</th><th>–û—á–∫–∏</th></tr><tr><td>2 ‚Äî 9</td><td>–ù–æ–º–∏–Ω–∞–ª</td></tr><tr><td>10, J, Q, K</td><td>0 –æ—á–∫–æ–≤</td></tr><tr><td>–¢—É–∑ (A)</td><td>1 –æ—á–∫–æ</td></tr></table><p style="margin-top:12px; font-size:0.9rem; color:rgba(232,224,208,0.6);">–ï—Å–ª–∏ —Å—É–º–º–∞ ‚â• 10, –æ—Ç –Ω–µ—ë –æ—Ç–Ω–∏–º–∞—é—Ç 10. –ù–∞–ø—Ä–∏–º–µ—Ä: 7+8=15 ‚Üí 5 –æ—á–∫–æ–≤.</p></div>
    <div class="rule-card"><h3>–°—Ç–∞–≤–∫–∏ –∏ –≤—ã–ø–ª–∞—Ç—ã</h3><ul><li><strong style="color:#2980b9">–ò–≥—Ä–æ–∫</strong> ‚Äî –≤—ã–ø–ª–∞—Ç–∞ 1:1</li><li><strong style="color:#c0392b">–ë–∞–Ω–∫–∏—Ä</strong> ‚Äî –≤—ã–ø–ª–∞—Ç–∞ 0.95:1 (5% –∫–æ–º–∏—Å—Å–∏—è)</li><li><strong style="color:var(--gold)">–ù–∏—á—å—è</strong> ‚Äî –≤—ã–ø–ª–∞—Ç–∞ 8:1</li></ul></div>
    <div class="rule-card"><h3>–ù–∞—Ç—É—Ä–∞–ª (Natural)</h3><p>–ï—Å–ª–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–≤—ã—Ö –¥–≤—É—Ö –∫–∞—Ä—Ç —Å—É–º–º–∞ –ò–≥—Ä–æ–∫–∞ –∏–ª–∏ –ë–∞–Ω–∫–∏—Ä–∞ —Ä–∞–≤–Ω–∞ <strong style="color:var(--gold)">8 –∏–ª–∏ 9</strong> ‚Äî –Ω–∞—Ç—É—Ä–∞–ª. –†–∞—É–Ω–¥ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ.</p></div>
    <div class="rule-card"><h3>–î–æ–±–æ—Ä ‚Äî –ò–≥—Ä–æ–∫</h3><ul><li>–°—É–º–º–∞ <strong>0‚Äì5</strong>: –±–µ—Ä—ë—Ç —Ç—Ä–µ—Ç—å—é –∫–∞—Ä—Ç—É</li><li>–°—É–º–º–∞ <strong>6‚Äì7</strong>: —Å—Ç–æ–∏—Ç</li><li>–°—É–º–º–∞ <strong>8‚Äì9</strong>: –Ω–∞—Ç—É—Ä–∞–ª</li></ul></div>
    <div class="rule-card"><h3>–î–æ–±–æ—Ä ‚Äî –ë–∞–Ω–∫–∏—Ä</h3><ul><li><strong>0‚Äì2</strong>: –±–µ—Ä—ë—Ç –≤—Å–µ–≥–¥–∞</li><li><strong>3</strong>: –±–µ—Ä—ë—Ç, –µ—Å–ª–∏ –∫–∞—Ä—Ç–∞ –ò–≥—Ä–æ–∫–∞ ‚â† 8</li><li><strong>4</strong>: –±–µ—Ä—ë—Ç, –µ—Å–ª–∏ –∫–∞—Ä—Ç–∞ –ò–≥—Ä–æ–∫–∞ 2‚Äì7</li><li><strong>5</strong>: –±–µ—Ä—ë—Ç, –µ—Å–ª–∏ –∫–∞—Ä—Ç–∞ –ò–≥—Ä–æ–∫–∞ 4‚Äì7</li><li><strong>6</strong>: –±–µ—Ä—ë—Ç, –µ—Å–ª–∏ –∫–∞—Ä—Ç–∞ –ò–≥—Ä–æ–∫–∞ 6‚Äì7</li><li><strong>7+</strong>: —Å—Ç–æ–∏—Ç</li></ul></div>
  </div>
</div>

<!-- ========== STATS TAB ========== -->
<div id="tab-stats" class="section">
  <div class="section-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
  <div class="gold-line"></div>
  <div class="stats-grid">
    <div class="stat-card"><span class="stat-value" id="s-games">0</span><span class="stat-label">–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ</span></div>
    <div class="stat-card"><span class="stat-value" id="s-wins">0</span><span class="stat-label">–ü–æ–±–µ–¥</span></div>
    <div class="stat-card"><span class="stat-value" id="s-losses">0</span><span class="stat-label">–ü–æ—Ä–∞–∂–µ–Ω–∏–π</span></div>
    <div class="stat-card"><span class="stat-value" id="s-ties">0</span><span class="stat-label">–ù–∏—á—å–∏—Ö</span></div>
    <div class="stat-card"><span class="stat-value" id="s-pnl" style="color:var(--gold)">‚ÇΩ 0</span><span class="stat-label">–ß–∏—Å—Ç—ã–π P&L</span></div>
    <div class="stat-card"><span class="stat-value" id="s-winrate">0%</span><span class="stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥</span></div>
  </div>
  <div class="win-bar-wrap">
    <div class="win-bar-labels"><span id="pct-player">–ò–≥—Ä–æ–∫ 0%</span><span id="pct-tie">–ù–∏—á—å—è 0%</span><span id="pct-banker">–ë–∞–Ω–∫–∏—Ä 0%</span></div>
    <div class="win-bar-track"><div class="win-bar-player" id="bar-player" style="width:0%"></div><div class="win-bar-tie" id="bar-tie" style="width:0%"></div><div class="win-bar-banker" id="bar-banker" style="width:0%"></div></div>
  </div>
  <div class="history-title" style="font-size:1rem; letter-spacing:5px; margin-bottom:10px; color:rgba(201,168,76,0.6);">–î–û–†–û–ñ–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í</div>
  <div class="road-map" id="road-map-stats" style="margin-bottom:28px;"></div>
  <div class="history-title">–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—É–Ω–¥–æ–≤</div>
  <div id="history-container">
    <div class="empty-history" id="empty-history">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞. –°—ã–≥—Ä–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —Ä–∞—É–Ω–¥!</div>
    <div class="history-table-wrap" id="history-table-wrap" style="display:none;">
      <table class="history-table">
        <thead><tr><th>#</th><th>–°—Ç–∞–≤–∫–∞ –Ω–∞</th><th>–°—Ç–∞–≤–∫–∞</th><th>–ò—Å—Ö–æ–¥</th><th>P&L</th><th>–°—á—ë—Ç</th></tr></thead>
        <tbody id="history-body"></tbody>
      </table>
    </div>
  </div>
  <button class="reset-btn" onclick="resetStats()">‚ö† –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
</div>

<div class="toast" id="toast"></div>

<script>
// ==================== CONSTANTS ====================
const SUITS = ['‚ô†','‚ô•','‚ô¶','‚ô£'];
const RANKS = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
const RED_SUITS = new Set(['‚ô•','‚ô¶']);
const BAL_KEY   = 'casinoBalance';
const STATS_KEY = 'baccarat_stats_v1';
const TX_KEY    = 'baccaratTxHistory';

// ==================== STATE ====================
let balance = parseInt(localStorage.getItem(BAL_KEY) || '10000');
let selectedZone = null;
let selectedBonusZone = null;
let lastBets = null;
let gameInProgress = false;
let gameSpeed = 'fast';

let bets = { player: 0, banker: 0, tie: 0 };
let bonusBets = { 'panda': 0, 'dragon-p': 0, 'dragon-b': 0, 'either-pair': 0, 'perfect-pair': 0 };
let lastBonusBets = null;

let stats = loadStats();
let txHistory = (()=>{ try{ return JSON.parse(localStorage.getItem(TX_KEY)||'[]'); }catch(e){ return []; } })();

// ==================== HELPERS ====================
function cardValue(rank){ if(rank==='A') return 1; if(['10','J','Q','K'].includes(rank)) return 0; return parseInt(rank); }
function handTotal(hand){ return hand.reduce((s,c)=>s+cardValue(c.rank),0)%10; }

function newDeck(){
  const deck=[];
  for(const s of SUITS) for(const r of RANKS) deck.push({rank:r,suit:s});
  for(let i=deck.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [deck[i],deck[j]]=[deck[j],deck[i]]; }
  return deck;
}

function renderCard(card, container, delayMs=0){
  const isRed=RED_SUITS.has(card.suit);
  const div=document.createElement('div'); div.className='playing-card';
  const dur=gameSpeed==='slow'?'0.6s':'0.25s';
  div.style.setProperty('--deal-duration',dur);
  if(delayMs) div.style.animationDelay=(delayMs/1000)+'s';
  div.innerHTML=`<div class="card-corner-top ${isRed?'card-red':'card-black'}">${card.rank}<br>${card.suit}</div><div class="card-suit-center ${isRed?'card-red':'card-black'}">${card.suit}</div><div class="card-corner-bottom ${isRed?'card-red':'card-black'}">${card.rank}<br>${card.suit}</div>`;
  container.appendChild(div);
}

function fmtMoney(n){ return '‚ÇΩ '+n.toLocaleString('ru-RU'); }
function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }
function t(ms){ return gameSpeed==='slow'?ms*4:ms; }

// ==================== SPEED ====================
function setSpeed(s){
  gameSpeed=s;
  document.getElementById('speed-slow').classList.toggle('active',s==='slow');
  document.getElementById('speed-fast').classList.toggle('active',s==='fast');
}

// ==================== BALANCE MODAL ====================
function openBalanceModal(){ renderBalanceModal(); document.getElementById('balanceModalOverlay').classList.add('open'); }
function closeBalanceModal(){ document.getElementById('balanceModalOverlay').classList.remove('open'); }
function closeBalanceModalOnBg(e){ if(e.target===document.getElementById('balanceModalOverlay')) closeBalanceModal(); }

function renderBalanceModal(){
  document.getElementById('bmAmount').textContent=fmtMoney(balance);
  const list=document.getElementById('bmTxList');
  if(!txHistory.length){ list.innerHTML='<div class="bm-empty">–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</div>'; return; }
  list.innerHTML='';
  txHistory.forEach(tx=>{
    const row=document.createElement('div'); row.className='tx-row';
    const credit=tx.amount>0;
    const d=new Date(tx.ts);
    const timeStr=d.toLocaleDateString('ru-RU',{day:'2-digit',month:'2-digit'})+' '+d.toLocaleTimeString('ru-RU',{hour:'2-digit',minute:'2-digit'});
    row.innerHTML=`<div><div class="tx-info-desc">${tx.desc}</div><div class="tx-info-time">${timeStr}</div></div><div class="tx-amount ${credit?'credit':'debit'}">${credit?'+':''}${fmtMoney(tx.amount)}</div>`;
    list.appendChild(row);
  });
}

function addFunds(){ balance+=10000; recordTx('–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞',10000); saveBalance(); updateUI(); renderBalanceModal(); showToast('+ 10 000 –¥–æ–±–∞–≤–ª–µ–Ω–æ'); playChipSound(false); }
function recordTx(desc,amount){ txHistory.unshift({desc,amount,ts:Date.now()}); if(txHistory.length>150) txHistory=txHistory.slice(0,150); localStorage.setItem(TX_KEY,JSON.stringify(txHistory)); }
function saveBalance(){ localStorage.setItem(BAL_KEY,balance); }

function openBonusModal(){ document.getElementById('bonusModalOverlay').classList.add('open'); }
function closeBonusModal(){ document.getElementById('bonusModalOverlay').classList.remove('open'); }
function closeBonusModalOnBg(e){ if(e.target===document.getElementById('bonusModalOverlay')) closeBonusModal(); }

function showTab(name,btn){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('tab-'+name).classList.add('active');
  if(btn) btn.classList.add('active');
  if(name==='stats') renderStats();
}

// ==================== BETTING ====================
function selectZone(zone){
  if(gameInProgress) return;
  selectedZone=zone; selectedBonusZone=null;
  document.querySelectorAll('.bet-zone,.tie-zone').forEach(z=>z.classList.remove('selected'));
  document.querySelectorAll('.bonus-zone').forEach(z=>z.classList.remove('selected'));
  document.getElementById('zone-'+zone).classList.add('selected');
  playZoneSelectSound();
}

function selectBonusZone(zone){
  if(gameInProgress) return;
  selectedBonusZone=zone; selectedZone=null;
  document.querySelectorAll('.bonus-zone').forEach(z=>z.classList.remove('selected'));
  document.querySelectorAll('.bet-zone,.tie-zone').forEach(z=>z.classList.remove('selected'));
  document.getElementById('bzone-'+zone).classList.add('selected');
  playZoneSelectSound();
  document.getElementById('betInput').focus();
}

function getInputBet(){ const val=parseInt(document.getElementById('betInput').value); return isNaN(val)||val<=0?0:val; }
function setQuickBet(val){ document.getElementById('betInput').value=val; playChipSelectSound(); }
function setBetMax(){ document.getElementById('betInput').value=Math.min(balance,50000); playChipSelectSound(); }

function placeBet(){
  if(gameInProgress) return;
  const betAmt=getInputBet();
  if(!betAmt){ showToast('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É —Å—Ç–∞–≤–∫–∏'); return; }
  if(selectedBonusZone){
    if(betAmt>balance){ showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'); return; }
    bonusBets[selectedBonusZone]+=betAmt; balance-=betAmt;
    document.getElementById('bbet-'+selectedBonusZone).textContent=fmtMoney(bonusBets[selectedBonusZone]);
    updateUI(); playChipSound(betAmt>=5000); return;
  }
  if(!selectedZone){ showToast('–í—ã–±–µ—Ä–∏—Ç–µ –∑–æ–Ω—É —Å—Ç–∞–≤–∫–∏'); return; }
  if(betAmt>balance){ showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'); return; }
  bets[selectedZone]+=betAmt; balance-=betAmt;
  document.getElementById('bet-'+selectedZone).textContent=fmtMoney(bets[selectedZone]);
  updateUI(); playChipSound(betAmt>=5000);
}

function clearBet(){
  if(gameInProgress) return;
  const total=Object.values(bets).reduce((a,b)=>a+b,0)+Object.values(bonusBets).reduce((a,b)=>a+b,0);
  const hasBets=total>0;
  balance+=total;
  bets={player:0,banker:0,tie:0};
  bonusBets={'panda':0,'dragon-p':0,'dragon-b':0,'either-pair':0,'perfect-pair':0};
  selectedZone=null; selectedBonusZone=null;
  document.querySelectorAll('.bet-zone,.tie-zone').forEach(z=>z.classList.remove('selected'));
  document.querySelectorAll('.bonus-zone').forEach(z=>z.classList.remove('selected'));
  for(const z of ['player','banker','tie']) document.getElementById('bet-'+z).textContent='‚Äî';
  for(const z of Object.keys(bonusBets)) document.getElementById('bbet-'+z).textContent='‚Äî';
  updateUI();
  if(hasBets) playClearBetsSound();
}

function rebet(){
  if(!lastBets||gameInProgress) return;
  const totalMain=Object.values(lastBets).reduce((a,b)=>a+b,0);
  const totalBonus=lastBonusBets?Object.values(lastBonusBets).reduce((a,b)=>a+b,0):0;
  if(totalMain+totalBonus>balance){ showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'); return; }
  clearBet();
  bets={...lastBets};
  if(lastBonusBets) bonusBets={...lastBonusBets};
  balance-=(totalMain+totalBonus);
  for(const z of ['player','banker','tie']) document.getElementById('bet-'+z).textContent=bets[z]>0?fmtMoney(bets[z]):'‚Äî';
  for(const z of Object.keys(bonusBets)) document.getElementById('bbet-'+z).textContent=bonusBets[z]>0?fmtMoney(bonusBets[z]):'‚Äî';
  updateUI(); playChipSound(false);
}

function updateUI(){
  document.getElementById('balance').textContent=fmtMoney(balance);
  document.getElementById('topbar-balance').textContent=fmtMoney(balance);
  saveBalance();
}

// ==================== DEAL ====================
async function deal(){
  const mainTotal=Object.values(bets).reduce((a,b)=>a+b,0);
  const bonusTotal=Object.values(bonusBets).reduce((a,b)=>a+b,0);

  if(mainTotal===0&&bonusTotal===0){
    const betAmt=getInputBet();
    if(betAmt>0&&selectedZone){
      if(betAmt>balance){ showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'); return; }
      bets[selectedZone]=betAmt; balance-=betAmt;
      document.getElementById('bet-'+selectedZone).textContent=fmtMoney(bets[selectedZone]);
      updateUI();
    } else if(betAmt>0&&selectedBonusZone){
      if(betAmt>balance){ showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'); return; }
      bonusBets[selectedBonusZone]=betAmt; balance-=betAmt;
      document.getElementById('bbet-'+selectedBonusZone).textContent=fmtMoney(bonusBets[selectedBonusZone]);
      updateUI();
    } else { showToast('–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–æ–Ω—É'); return; }
  }

  const totalBet=Object.values(bets).reduce((a,b)=>a+b,0)+Object.values(bonusBets).reduce((a,b)=>a+b,0);
  if(totalBet===0){ showToast('–°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É'); return; }
  if(gameInProgress) return;

  gameInProgress=true;
  document.getElementById('deal-btn').disabled=true;
  document.getElementById('rebet-btn').disabled=true;

  const betZone=bets.player>0?'–ò–≥—Ä–æ–∫':bets.banker>0?'–ë–∞–Ω–∫–∏—Ä':bets.tie>0?'–ù–∏—á—å—è':'–ë–æ–Ω—É—Å';
  if(Object.values(bets).reduce((a,b)=>a+b,0)>0) recordTx(`–ë–∞–∫–∫–∞—Ä–∞ ‚Äî —Å—Ç–∞–≤–∫–∞ –Ω–∞ ${betZone}`,-Object.values(bets).reduce((a,b)=>a+b,0));
  if(bonusTotal>0) recordTx('–ë–∞–∫–∫–∞—Ä–∞ ‚Äî –±–æ–Ω—É—Å–Ω—ã–µ —Å—Ç–∞–≤–∫–∏',-bonusTotal);

  document.getElementById('player-cards').innerHTML='';
  document.getElementById('banker-cards').innerHTML='';
  document.getElementById('player-score').textContent='';
  document.getElementById('banker-score').textContent='';
  document.getElementById('result-msg').innerHTML='<span class="result-text" style="color:rgba(201,168,76,0.3); font-style:italic;">–†–∞–∑–¥–∞—á–∞...</span>';

  const deck=newDeck(); let di=0;
  const draw=()=>deck[di++];

  const playerHand=[draw(),draw()];
  const bankerHand=[draw(),draw()];

  const pContainer=document.getElementById('player-cards');
  const bContainer=document.getElementById('banker-cards');

  // Deal initial 4 cards with sounds
  playDealSound('player', 0);
  renderCard(playerHand[0],pContainer);
  await sleep(t(200));
  playDealSound('banker', 0);
  renderCard(bankerHand[0],bContainer);
  await sleep(t(200));
  playDealSound('player', 1);
  renderCard(playerHand[1],pContainer);
  await sleep(t(200));
  playDealSound('banker', 1);
  renderCard(bankerHand[1],bContainer);
  await sleep(t(350));

  let pTotal=handTotal(playerHand);
  let bTotal=handTotal(bankerHand);
  document.getElementById('player-score').textContent=pTotal;
  document.getElementById('banker-score').textContent=bTotal;
  await sleep(t(200));

  const natural=pTotal>=8||bTotal>=8;
  if(natural) playNaturalSound();

  let playerThird=null, bankerThird=null;

  if(!natural){
    if(pTotal<=5){
      playerThird=draw(); playerHand.push(playerThird);
      playDealSound('player', 2);
      renderCard(playerThird,pContainer);
      await sleep(t(350));
      pTotal=handTotal(playerHand);
      document.getElementById('player-score').textContent=pTotal;
      await sleep(t(150));
    }

    let bankerDraws=false;
    if(playerThird===null){ bankerDraws=bTotal<=5; }
    else{
      const p3=cardValue(playerThird.rank);
      if(bTotal<=2) bankerDraws=true;
      else if(bTotal===3) bankerDraws=p3!==8;
      else if(bTotal===4) bankerDraws=p3>=2&&p3<=7;
      else if(bTotal===5) bankerDraws=p3>=4&&p3<=7;
      else if(bTotal===6) bankerDraws=p3===6||p3===7;
    }

    if(bankerDraws){
      bankerThird=draw(); bankerHand.push(bankerThird);
      playDealSound('banker', 2);
      renderCard(bankerThird,bContainer);
      await sleep(t(350));
      bTotal=handTotal(bankerHand);
      document.getElementById('banker-score').textContent=bTotal;
      await sleep(t(150));
    }
  }

  let outcome;
  if(pTotal>bTotal) outcome='player';
  else if(bTotal>pTotal) outcome='banker';
  else outcome='tie';

  // ‚îÄ‚îÄ MAIN BET PAYOUT ‚îÄ‚îÄ
  let winAmount=0;
  if(outcome==='player'&&bets.player>0) winAmount+=bets.player*2;
  if(outcome==='banker'&&bets.banker>0) winAmount+=Math.floor(bets.banker*1.95);
  if(outcome==='tie'){
    if(bets.tie>0) winAmount+=bets.tie*9;
    if(bets.player>0) winAmount+=bets.player;
    if(bets.banker>0) winAmount+=bets.banker;
  }

  // ‚îÄ‚îÄ BONUS BET PAYOUT ‚îÄ‚îÄ
  let bonusWin=0;
  const bonusResults=[];

  if(bonusBets['panda']>0){
    if(outcome==='banker'&&bankerHand.length===3&&bTotal===8){
      bonusWin+=bonusBets['panda']*26;
      bonusResults.push('üêº Panda 8: +'+fmtMoney(bonusBets['panda']*25));
    }
  }
  if(bonusBets['dragon-p']>0){
    let dbP=calcDragonBonus('player',outcome,pTotal,bTotal,playerHand,natural);
    if(dbP>0){ bonusWin+=bonusBets['dragon-p']*(dbP+1); bonusResults.push('üêâ Dragon –ò–≥—Ä–æ–∫: +'+fmtMoney(bonusBets['dragon-p']*dbP)); }
    else if(dbP===0){ bonusWin+=bonusBets['dragon-p']; bonusResults.push('üêâ Dragon –ò–≥—Ä–æ–∫: –≤–æ–∑–≤—Ä–∞—Ç'); }
  }
  if(bonusBets['dragon-b']>0){
    let dbB=calcDragonBonus('banker',outcome,bTotal,pTotal,bankerHand,natural);
    if(dbB>0){ bonusWin+=bonusBets['dragon-b']*(dbB+1); bonusResults.push('üêâ Dragon –ë–∞–Ω–∫–∏—Ä: +'+fmtMoney(bonusBets['dragon-b']*dbB)); }
    else if(dbB===0){ bonusWin+=bonusBets['dragon-b']; bonusResults.push('üêâ Dragon –ë–∞–Ω–∫–∏—Ä: –≤–æ–∑–≤—Ä–∞—Ç'); }
  }
  if(bonusBets['either-pair']>0){
    const pPair=playerHand[0].rank===playerHand[1].rank;
    const bPair=bankerHand[0].rank===bankerHand[1].rank;
    if(pPair||bPair){ bonusWin+=bonusBets['either-pair']*6; bonusResults.push('üëë Either Pair: +'+fmtMoney(bonusBets['either-pair']*5)); }
  }
  if(bonusBets['perfect-pair']>0){
    const pp=playerHand[0].rank===playerHand[1].rank;
    const pb=bankerHand[0].rank===bankerHand[1].rank;
    if(pp||pb){
      const hand=pp?playerHand:bankerHand;
      const perfectSuit=hand[0].suit===hand[1].suit;
      const mult=perfectSuit?26:9;
      bonusWin+=bonusBets['perfect-pair']*mult;
      bonusResults.push('üÉè Perfect Pair ('+(perfectSuit?'25:1':'8:1')+'): +'+fmtMoney(bonusBets['perfect-pair']*(mult-1)));
    }
  }

  balance+=winAmount+bonusWin;
  const mainPnl=winAmount-Object.values(bets).reduce((a,b)=>a+b,0);
  const totalPnl=mainPnl+bonusWin-Object.values(bonusBets).reduce((a,b)=>a+b,0);

  if(winAmount>0){ const outcomeLabel={player:'–ø–æ–±–µ–¥–∞ –ò–≥—Ä–æ–∫–∞',banker:'–ø–æ–±–µ–¥–∞ –ë–∞–Ω–∫–∏—Ä–∞',tie:'–Ω–∏—á—å—è'}[outcome]; recordTx(`–ë–∞–∫–∫–∞—Ä–∞ ‚Äî ${outcomeLabel}`,winAmount); }
  if(bonusWin>0) recordTx('–ë–∞–∫–∫–∞—Ä–∞ ‚Äî –±–æ–Ω—É—Å–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã',bonusWin);

  // ‚îÄ‚îÄ PLAY WIN/LOSS SOUND ‚îÄ‚îÄ
  const anyWin = winAmount>0 || bonusWin>0;
  if(anyWin){
    const bigWin = totalPnl >= Object.values(bets).reduce((a,b)=>a+b,0)*3 || totalPnl >= 10000 || bonusWin > 5000;
    playWinSound(bigWin);
  } else {
    playLossSound();
  }

  const resultMap={
    player:{label:'–ü–æ–±–µ–¥–∞ –ò–≥—Ä–æ–∫–∞!',cls:'result-win'},
    banker:{label:'–ü–æ–±–µ–¥–∞ –ë–∞–Ω–∫–∏—Ä–∞!',cls:'result-loss'},
    tie:{label:'–ù–∏—á—å—è!',cls:'result-tie'},
  };
  const r=resultMap[outcome];
  const pnlStr=totalPnl>=0?`+${fmtMoney(totalPnl)}`:fmtMoney(totalPnl);
  const bonusLine=bonusResults.length?`<div style="font-size:0.8rem; color:#e8d08a; margin-top:6px;">${bonusResults.join(' &nbsp;|&nbsp; ')}</div>`:'';

  document.getElementById('result-msg').innerHTML=`<div><div class="result-text ${r.cls}">${r.label}</div><div style="font-size:0.95rem; margin-top:5px; color:${totalPnl>=0?'#2ecc71':'#e74c3c'}">${pnlStr}</div>${bonusLine}</div>`;

  updateUI();
  lastBets={...bets};
  lastBonusBets={...bonusBets};
  recordGame(outcome,bets,totalPnl,pTotal,bTotal);

  if(balance<=0){
    await sleep(t(600));
    showToast('–ë–∞–ª–∞–Ω—Å –∏—Å—á–µ—Ä–ø–∞–Ω! –ü–æ–ø–æ–ª–Ω—è–µ–º –¥–æ ‚ÇΩ 10,000');
    balance=10000; recordTx('–ê–≤—Ç–æ–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞',10000); updateUI();
  }

  bets={player:0,banker:0,tie:0};
  bonusBets={'panda':0,'dragon-p':0,'dragon-b':0,'either-pair':0,'perfect-pair':0};
  for(const z of ['player','banker','tie']) document.getElementById('bet-'+z).textContent='‚Äî';
  for(const z of Object.keys(bonusBets)) document.getElementById('bbet-'+z).textContent='‚Äî';
  renderRoadMapGame();

  gameInProgress=false;
  document.getElementById('deal-btn').disabled=false;
  document.getElementById('rebet-btn').disabled=false;
}

function calcDragonBonus(side,outcome,myTotal,oppTotal,myHand,natural){
  if(outcome==='tie') return -1;
  if(outcome!==side) return -1;
  if(natural&&myTotal>=8){ if(myTotal>oppTotal) return 1; if(myTotal===oppTotal) return 0; }
  const diff=myTotal-oppTotal;
  if(diff<=0) return -1;
  if(diff>=9) return 30;
  if(diff===8) return 10;
  if(diff===7) return 6;
  if(diff===6) return 4;
  if(diff===5) return 2;
  if(diff===4) return 1;
  return -1;
}

// ==================== STATS ====================
function loadStats(){
  try{ const raw=localStorage.getItem(STATS_KEY); if(raw) return JSON.parse(raw); }catch(e){}
  return {games:0,wins:0,losses:0,ties:0,pnl:0,outcomeHistory:[],rounds:[]};
}
function saveStats(){ localStorage.setItem(STATS_KEY,JSON.stringify(stats)); }

function recordGame(outcome,bets,pnl,pScore,bScore){
  stats.games++;
  const betWon=(outcome==='player'&&bets.player>0)||(outcome==='banker'&&bets.banker>0)||(outcome==='tie'&&bets.tie>0);
  if(outcome==='tie') stats.ties++;
  else if(betWon) stats.wins++;
  else stats.losses++;
  stats.pnl+=pnl;
  const outcomeChar=outcome==='player'?'P':outcome==='banker'?'B':'T';
  stats.outcomeHistory.push(outcomeChar);
  const betOn=bets.player>0?'–ò–≥—Ä–æ–∫':bets.banker>0?'–ë–∞–Ω–∫–∏—Ä':'–ù–∏—á—å—è';
  const betAmt=bets.player||bets.banker||bets.tie;
  stats.rounds.unshift({n:stats.games,betOn,betAmt,outcome:outcomeChar,pnl,score:`${pScore} ‚Äî ${bScore}`,betWon});
  if(stats.rounds.length>100) stats.rounds=stats.rounds.slice(0,100);
  if(stats.outcomeHistory.length>80) stats.outcomeHistory=stats.outcomeHistory.slice(-80);
  saveStats();
}

function renderRoadMapGame(){
  const road=document.getElementById('road-map-game'); road.innerHTML='';
  stats.outcomeHistory.slice(-40).forEach(o=>{
    const dot=document.createElement('div'); dot.className=`road-dot road-${o}`; dot.textContent=o; road.appendChild(dot);
  });
}

function renderStats(){
  document.getElementById('s-games').textContent=stats.games;
  document.getElementById('s-wins').textContent=stats.wins;
  document.getElementById('s-losses').textContent=stats.losses;
  document.getElementById('s-ties').textContent=stats.ties;
  const pnlEl=document.getElementById('s-pnl');
  pnlEl.textContent=(stats.pnl>=0?'+':'')+fmtMoney(stats.pnl);
  pnlEl.style.color=stats.pnl>=0?'#2ecc71':'#e74c3c';
  document.getElementById('s-winrate').textContent=(stats.games>0?Math.round(stats.wins/stats.games*100):0)+'%';
  const road=document.getElementById('road-map-stats'); road.innerHTML='';
  stats.outcomeHistory.forEach(o=>{ const dot=document.createElement('div'); dot.className=`road-dot road-${o}`; dot.textContent=o; road.appendChild(dot); });
  const allO=stats.outcomeHistory.length;
  const pO=stats.outcomeHistory.filter(o=>o==='P').length;
  const bO=stats.outcomeHistory.filter(o=>o==='B').length;
  const tO=stats.outcomeHistory.filter(o=>o==='T').length;
  const pP=allO>0?Math.round(pO/allO*100):0;
  const bP=allO>0?Math.round(bO/allO*100):0;
  const tP=allO>0?Math.round(tO/allO*100):0;
  document.getElementById('bar-player').style.width=pP+'%';
  document.getElementById('bar-banker').style.width=bP+'%';
  document.getElementById('bar-tie').style.width=tP+'%';
  document.getElementById('pct-player').textContent=`–ò–≥—Ä–æ–∫ ${pP}%`;
  document.getElementById('pct-banker').textContent=`–ë–∞–Ω–∫–∏—Ä ${bP}%`;
  document.getElementById('pct-tie').textContent=`–ù–∏—á—å—è ${tP}%`;
  const empty=document.getElementById('empty-history');
  const tbody=document.getElementById('history-body');
  if(stats.rounds.length===0){ empty.style.display='block'; document.getElementById('history-table-wrap').style.display='none'; return; }
  empty.style.display='none'; document.getElementById('history-table-wrap').style.display='block';
  tbody.innerHTML='';
  stats.rounds.forEach(r=>{
    const pnlStr=(r.pnl>=0?'+':'')+fmtMoney(r.pnl);
    const pnlColor=r.pnl>0?'#2ecc71':r.pnl<0?'#e74c3c':'var(--gold)';
    const outLabelMap={P:'–ò–≥—Ä–æ–∫',B:'–ë–∞–Ω–∫–∏—Ä',T:'–ù–∏—á—å—è'};
    const pillClass=r.betWon?'pill-win':r.outcome==='T'?'pill-tie':'pill-loss';
    const tr=document.createElement('tr');
    tr.innerHTML=`<td style="opacity:0.5">#${r.n}</td><td>${r.betOn}</td><td>${fmtMoney(r.betAmt)}</td><td><span class="pill ${pillClass}">${outLabelMap[r.outcome]}</span></td><td style="color:${pnlColor}">${pnlStr}</td><td style="font-family:'Playfair Display',serif; color:var(--gold)">${r.score}</td>`;
    tbody.appendChild(tr);
  });
}

function resetStats(){
  if(!confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É?')) return;
  stats={games:0,wins:0,losses:0,ties:0,pnl:0,outcomeHistory:[],rounds:[]};
  saveStats(); renderStats(); renderRoadMapGame(); showToast('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–±—Ä–æ—à–µ–Ω–∞');
}

function showToast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2500); }

// ==================== AUDIO ENGINE ====================
let audioCtx   = null;
let musicGain  = null;
let musicNodes = [];
let musicLoopTimer = null;
let sfxEnabled   = true;
let musicEnabled = false;

function getAudioCtx(){
  if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  if(audioCtx.state==='suspended') audioCtx.resume();
  return audioCtx;
}

function makeNoiseBuf(ctx,dur){
  const sz=Math.ceil(ctx.sampleRate*dur);
  const buf=ctx.createBuffer(1,sz,ctx.sampleRate);
  const d=buf.getChannelData(0);
  for(let i=0;i<sz;i++) d[i]=(Math.random()*2-1);
  return buf;
}

function playNode(ctx,src,gain,startT,stopT){
  src.connect(gain); gain.connect(ctx.destination);
  src.start(startT); if(stopT!==undefined) src.stop(stopT);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// CARD DEAL SOUND ‚Äî realistic card slide on felt
// Each call sounds slightly different (randomised pitch/velocity)
// side: 'player' | 'banker'  cardIndex: 0,1,2
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function playDealSound(side, cardIndex) {
  if(!sfxEnabled) return;
  try {
    const ctx = getAudioCtx();
    const t0  = ctx.currentTime;
    // Add tiny random humanisation
    const jitter = Math.random()*0.008;

    // ‚îÄ‚îÄ 1. Card slide swish ‚Äî filtered noise ‚îÄ‚îÄ
    const swishBuf = makeNoiseBuf(ctx, 0.14);
    const swishSrc = ctx.createBufferSource(); swishSrc.buffer = swishBuf;
    const swishBPF = ctx.createBiquadFilter(); swishBPF.type='bandpass';
    swishBPF.frequency.value = 3000 + Math.random()*1000;
    swishBPF.Q.value = 1.2;
    const swishG = ctx.createGain();
    swishG.gain.setValueAtTime(0, t0+jitter);
    swishG.gain.linearRampToValueAtTime(0.065, t0+jitter+0.025);
    swishG.gain.exponentialRampToValueAtTime(0.0001, t0+jitter+0.12);
    swishSrc.connect(swishBPF); swishBPF.connect(swishG); swishG.connect(ctx.destination);
    swishSrc.start(t0+jitter); swishSrc.stop(t0+jitter+0.15);

    // ‚îÄ‚îÄ 2. Card landing "thwack" on felt ‚îÄ‚îÄ
    const landT = t0 + jitter + 0.065;
    const thwackBuf = makeNoiseBuf(ctx, 0.06);
    const thwackSrc = ctx.createBufferSource(); thwackSrc.buffer = thwackBuf;
    const thwackLPF = ctx.createBiquadFilter(); thwackLPF.type='lowpass'; thwackLPF.frequency.value=600;
    const thwackG = ctx.createGain();
    thwackG.gain.setValueAtTime(0.18, landT);
    thwackG.gain.exponentialRampToValueAtTime(0.0001, landT+0.055);
    thwackSrc.connect(thwackLPF); thwackLPF.connect(thwackG); thwackG.connect(ctx.destination);
    thwackSrc.start(landT); thwackSrc.stop(landT+0.065);

    // ‚îÄ‚îÄ 3. Stiff card "snap" transient ‚îÄ‚îÄ
    const snapFreq = 1800 + cardIndex*120 + (side==='banker'?200:0) + Math.random()*200;
    const snapO = ctx.createOscillator(); snapO.type='triangle';
    snapO.frequency.setValueAtTime(snapFreq, landT);
    snapO.frequency.exponentialRampToValueAtTime(snapFreq*0.4, landT+0.03);
    const snapG = ctx.createGain();
    snapG.gain.setValueAtTime(0.045, landT);
    snapG.gain.exponentialRampToValueAtTime(0.0001, landT+0.04);
    playNode(ctx, snapO, snapG, landT, landT+0.045);

    // ‚îÄ‚îÄ 4. Subtle felt-on-table body resonance (low thud) ‚îÄ‚îÄ
    const bodyO = ctx.createOscillator(); bodyO.type='sine';
    bodyO.frequency.setValueAtTime(140, landT);
    bodyO.frequency.exponentialRampToValueAtTime(55, landT+0.06);
    const bodyG = ctx.createGain();
    bodyG.gain.setValueAtTime(0.09, landT);
    bodyG.gain.exponentialRampToValueAtTime(0.0001, landT+0.07);
    playNode(ctx, bodyO, bodyG, landT, landT+0.08);

  } catch(e){}
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// CHIP PLACE SOUND ‚Äî ceramic chip on felt
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function playChipSound(highValue) {
  if(!sfxEnabled) return;
  try {
    const ctx = getAudioCtx();
    const t   = ctx.currentTime;
    const vol = highValue ? 1.0 : 0.8;

    [0, 0.008].forEach((dt, i) => {
      const freq  = highValue ? 2800 - i*300 : 2200 - i*200;
      const decay = 0.06 + i*0.01;
      const o = ctx.createOscillator(); o.type='sine';
      o.frequency.setValueAtTime(freq, t+dt);
      o.frequency.exponentialRampToValueAtTime(freq*0.55, t+dt+decay);
      const g = ctx.createGain();
      g.gain.setValueAtTime(0, t+dt);
      g.gain.linearRampToValueAtTime(0.18*vol, t+dt+0.002);
      g.gain.exponentialRampToValueAtTime(0.0001, t+dt+decay);
      playNode(ctx, o, g, t+dt, t+dt+decay+0.01);
    });

    const clink = ctx.createOscillator(); clink.type='triangle';
    clink.frequency.setValueAtTime(highValue?4400:3600, t);
    clink.frequency.exponentialRampToValueAtTime(highValue?2800:2200, t+0.025);
    const clinkG = ctx.createGain(); clinkG.gain.setValueAtTime(0.09*vol, t); clinkG.gain.exponentialRampToValueAtTime(0.0001, t+0.05);
    playNode(ctx, clink, clinkG, t, t+0.055);

    const noise=makeNoiseBuf(ctx,0.08);
    const nSrc=ctx.createBufferSource(); nSrc.buffer=noise;
    const lpf=ctx.createBiquadFilter(); lpf.type='lowpass'; lpf.frequency.value=800;
    const thudG=ctx.createGain(); thudG.gain.setValueAtTime(0.22*vol, t+0.003); thudG.gain.exponentialRampToValueAtTime(0.0001, t+0.08);
    nSrc.connect(lpf); lpf.connect(thudG); thudG.connect(ctx.destination);
    nSrc.start(t+0.003); nSrc.stop(t+0.09);

    if(highValue){
      [0.014, 0.024].forEach(dt=>{
        const r=ctx.createOscillator(); r.type='sine'; r.frequency.value=3100;
        const rg=ctx.createGain(); rg.gain.setValueAtTime(0.06, t+dt); rg.gain.exponentialRampToValueAtTime(0.0001, t+dt+0.025);
        playNode(ctx, r, rg, t+dt, t+dt+0.03);
      });
    }
  } catch(e){}
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// CHIP SELECT ‚Äî light pick-up sound
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function playChipSelectSound() {
  if(!sfxEnabled) return;
  try {
    const ctx = getAudioCtx();
    const t   = ctx.currentTime;
    const o   = ctx.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(3000, t); o.frequency.exponentialRampToValueAtTime(1800, t+0.04);
    const g   = ctx.createGain(); g.gain.setValueAtTime(0.07, t); g.gain.exponentialRampToValueAtTime(0.0001, t+0.05);
    playNode(ctx, o, g, t, t+0.055);
    const nb=makeNoiseBuf(ctx,0.03); const ns=ctx.createBufferSource(); ns.buffer=nb;
    const hpf=ctx.createBiquadFilter(); hpf.type='highpass'; hpf.frequency.value=4000;
    const ng=ctx.createGain(); ng.gain.setValueAtTime(0.04, t); ng.gain.exponentialRampToValueAtTime(0.0001, t+0.03);
    ns.connect(hpf); hpf.connect(ng); ng.connect(ctx.destination); ns.start(t); ns.stop(t+0.035);
  } catch(e){}
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// ZONE SELECT SOUND ‚Äî soft felt tap when clicking a bet zone
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function playZoneSelectSound() {
  if(!sfxEnabled) return;
  try {
    const ctx = getAudioCtx();
    const t   = ctx.currentTime;

    // Muffled felt tap
    const nb  = makeNoiseBuf(ctx, 0.05);
    const ns  = ctx.createBufferSource(); ns.buffer=nb;
    const lpf = ctx.createBiquadFilter(); lpf.type='lowpass'; lpf.frequency.value=400;
    const g   = ctx.createGain(); g.gain.setValueAtTime(0.09, t); g.gain.exponentialRampToValueAtTime(0.0001, t+0.05);
    ns.connect(lpf); lpf.connect(g); g.connect(ctx.destination); ns.start(t); ns.stop(t+0.06);

    // Tiny resonant click
    const o = ctx.createOscillator(); o.type='sine'; o.frequency.value=800;
    const og= ctx.createGain(); og.gain.setValueAtTime(0.025, t); og.gain.exponentialRampToValueAtTime(0.0001, t+0.04);
    playNode(ctx, o, og, t, t+0.045);
  } catch(e){}
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// NATURAL SOUND ‚Äî distinctive two-tone chime when a natural is dealt
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function playNaturalSound() {
  if(!sfxEnabled) return;
  try {
    const ctx = getAudioCtx();
    const t0  = ctx.currentTime;

    // Two-tone bell: major third
    [0, 0.14].forEach((dt, i) => {
      const freq = i===0 ? 880 : 1108;  // A5, C#6 (major third)
      const o = ctx.createOscillator(); o.type='sine';
      o.frequency.setValueAtTime(freq, t0+dt);
      const g = ctx.createGain();
      g.gain.setValueAtTime(0, t0+dt);
      g.gain.linearRampToValueAtTime(0.1, t0+dt+0.008);
      g.gain.setValueAtTime(0.1, t0+dt+0.05);
      g.gain.exponentialRampToValueAtTime(0.0001, t0+dt+0.55);
      playNode(ctx, o, g, t0+dt, t0+dt+0.58);

      // Bell overtone
      const h = ctx.createOscillator(); h.type='triangle'; h.frequency.value=freq*2.756;
      const hg= ctx.createGain(); hg.gain.setValueAtTime(0.022, t0+dt); hg.gain.exponentialRampToValueAtTime(0.0001, t0+dt+0.2);
      playNode(ctx, h, hg, t0+dt, t0+dt+0.22);
    });

    // Anticipation shimmer
    const shNb  = makeNoiseBuf(ctx, 0.04);
    const shSrc = ctx.createBufferSource(); shSrc.buffer=shNb;
    const shHPF = ctx.createBiquadFilter(); shHPF.type='highpass'; shHPF.frequency.value=6000;
    const shG   = ctx.createGain(); shG.gain.setValueAtTime(0.04, t0); shG.gain.exponentialRampToValueAtTime(0.0001, t0+0.04);
    shSrc.connect(shHPF); shHPF.connect(shG); shG.connect(ctx.destination); shSrc.start(t0); shSrc.stop(t0+0.045);
  } catch(e){}
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// CLEAR BETS ‚Äî sweeping chips off table
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function playClearBetsSound() {
  if(!sfxEnabled) return;
  try {
    const ctx = getAudioCtx();
    const t   = ctx.currentTime;
    const nb  = makeNoiseBuf(ctx, 0.25);
    const ns  = ctx.createBufferSource(); ns.buffer=nb;
    const bpf = ctx.createBiquadFilter(); bpf.type='bandpass'; bpf.frequency.value=3000; bpf.Q.value=0.8;
    const g   = ctx.createGain();
    g.gain.setValueAtTime(0, t); g.gain.linearRampToValueAtTime(0.06, t+0.03); g.gain.exponentialRampToValueAtTime(0.0001, t+0.22);
    ns.connect(bpf); bpf.connect(g); g.connect(ctx.destination); ns.start(t); ns.stop(t+0.26);
    [0, 0.06, 0.11].forEach((dt, i)=>{
      const f=2400-i*200; const o=ctx.createOscillator(); o.type='sine'; o.frequency.value=f;
      const og=ctx.createGain(); og.gain.setValueAtTime(0.04, t+dt); og.gain.exponentialRampToValueAtTime(0.0001, t+dt+0.04);
      playNode(ctx, o, og, t+dt, t+dt+0.045);
    });
  } catch(e){}
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// WIN SOUND ‚Äî triumphant multi-layer casino jingle
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function playWinSound(bigWin) {
  if(!sfxEnabled) return;
  try {
    const ctx = getAudioCtx();
    const t0  = ctx.currentTime;

    if(bigWin) {
      // BIG WIN: Full ascending fanfare + coin shower
      const fanfareNotes = [523, 659, 784, 988, 1047, 1319, 1568];
      fanfareNotes.forEach((freq, i) => {
        const t = t0 + i*0.075;
        const o = ctx.createOscillator(); o.type='triangle'; o.frequency.setValueAtTime(freq, t);
        const g = ctx.createGain();
        g.gain.setValueAtTime(0, t); g.gain.linearRampToValueAtTime(0.12, t+0.01);
        g.gain.setValueAtTime(0.12, t+0.07); g.gain.exponentialRampToValueAtTime(0.001, t+0.3);
        playNode(ctx, o, g, t, t+0.32);
        [2, 3].forEach(mult => {
          const h=ctx.createOscillator(); h.type='sine'; h.frequency.value=freq*mult;
          const hg=ctx.createGain(); hg.gain.setValueAtTime(0.025/mult, t); hg.gain.exponentialRampToValueAtTime(0.001, t+0.18);
          playNode(ctx, h, hg, t, t+0.2);
        });
      });
      for(let i=0;i<24;i++){
        const dt=0.05+i*0.055+Math.random()*0.03;
        const f=2000+Math.random()*2000;
        const c=ctx.createOscillator(); c.type='sine'; c.frequency.setValueAtTime(f,t0+dt); c.frequency.exponentialRampToValueAtTime(f*0.5,t0+dt+0.04);
        const cg=ctx.createGain(); cg.gain.setValueAtTime(0.06,t0+dt); cg.gain.exponentialRampToValueAtTime(0.0001,t0+dt+0.05);
        playNode(ctx, c, cg, t0+dt, t0+dt+0.06);
      }
      [130.8,196,261.6,329.6].forEach(freq=>{
        const o=ctx.createOscillator(); o.type='sawtooth'; o.frequency.value=freq;
        const lpf=ctx.createBiquadFilter(); lpf.type='lowpass'; lpf.frequency.value=800;
        const g=ctx.createGain(); g.gain.setValueAtTime(0,t0+0.05); g.gain.linearRampToValueAtTime(0.03,t0+0.15); g.gain.exponentialRampToValueAtTime(0.001,t0+0.8);
        o.connect(lpf); lpf.connect(g); g.connect(ctx.destination); o.start(t0+0.05); o.stop(t0+0.85);
      });
    } else {
      // NORMAL WIN
      const notes=[659,784,988,1319];
      notes.forEach((freq,i)=>{
        const t=t0+i*0.09;
        const o=ctx.createOscillator(); o.type='triangle'; o.frequency.value=freq;
        const g=ctx.createGain(); g.gain.setValueAtTime(0.09,t); g.gain.setValueAtTime(0.09,t+0.04); g.gain.exponentialRampToValueAtTime(0.001,t+0.22);
        playNode(ctx, o, g, t, t+0.24);
        const h=ctx.createOscillator(); h.type='sine'; h.frequency.value=freq*2.01;
        const hg=ctx.createGain(); hg.gain.setValueAtTime(0.025,t); hg.gain.exponentialRampToValueAtTime(0.001,t+0.1);
        playNode(ctx, h, hg, t, t+0.12);
      });
      [0,0.08].forEach(dt=>{
        const f=2600+Math.random()*600;
        const c=ctx.createOscillator(); c.type='sine'; c.frequency.setValueAtTime(f,t0+dt); c.frequency.exponentialRampToValueAtTime(f*0.55,t0+dt+0.04);
        const cg=ctx.createGain(); cg.gain.setValueAtTime(0.07,t0+dt); cg.gain.exponentialRampToValueAtTime(0.0001,t0+dt+0.05);
        playNode(ctx, c, cg, t0+dt, t0+dt+0.06);
      });
    }
  } catch(e){}
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// LOSS SOUND ‚Äî short dull thud/fail tone
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function playLossSound() {
  if(!sfxEnabled) return;
  try {
    const ctx=getAudioCtx(); const t=ctx.currentTime;
    const o=ctx.createOscillator(); o.type='sawtooth';
    o.frequency.setValueAtTime(220,t); o.frequency.exponentialRampToValueAtTime(80,t+0.35);
    const lpf=ctx.createBiquadFilter(); lpf.type='lowpass'; lpf.frequency.value=400;
    const g=ctx.createGain(); g.gain.setValueAtTime(0.07,t); g.gain.exponentialRampToValueAtTime(0.0001,t+0.4);
    o.connect(lpf); lpf.connect(g); g.connect(ctx.destination); o.start(t); o.stop(t+0.42);
    const nb=makeNoiseBuf(ctx,0.12); const ns=ctx.createBufferSource(); ns.buffer=nb;
    const nlpf=ctx.createBiquadFilter(); nlpf.type='lowpass'; nlpf.frequency.value=300;
    const ng=ctx.createGain(); ng.gain.setValueAtTime(0.12,t+0.01); ng.gain.exponentialRampToValueAtTime(0.0001,t+0.14);
    ns.connect(nlpf); nlpf.connect(ng); ng.connect(ctx.destination); ns.start(t+0.01); ns.stop(t+0.15);
  } catch(e){}
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// BACKGROUND MUSIC ‚Äî Vegas swing loop
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function startMusic(){
  if(!musicEnabled) return;
  stopMusic();
  try {
    const ctx=getAudioCtx();
    const masterGain=ctx.createGain(); masterGain.gain.value=0.08; masterGain.connect(ctx.destination);
    musicGain=masterGain;
    const BPM=126,B=60/BPM,bar=B*4;
    const chordVoicings=[[116.5,155.6,174.6,233.1,311.1],[98.0,146.8,196.0,220.0,293.7],[130.8,155.6,196.0,261.6,329.6],[87.3,138.6,174.6,207.7,277.2]];
    const bassLines=[[58.3,65.4,69.3,77.8],[49.0,55.0,61.7,65.4],[65.4,73.4,77.8,87.3],[43.7,49.0,55.0,58.3]];
    function noteOn(freq,startT,dur,vol,type='sine'){
      try{
        const o=ctx.createOscillator(); o.type=type; o.frequency.value=freq;
        const g=ctx.createGain();
        g.gain.setValueAtTime(0,startT); g.gain.linearRampToValueAtTime(vol,startT+0.015);
        g.gain.setValueAtTime(vol,startT+dur*0.75); g.gain.linearRampToValueAtTime(0,startT+dur);
        o.connect(g); g.connect(masterGain); o.start(startT); o.stop(startT+dur+0.02); musicNodes.push(o);
      }catch(e){}
    }
    function scheduleHiHat(startT,numBars){
      try{
        const steps=numBars*8;
        for(let i=0;i<steps;i++){
          const t0=startT+i*(B/2); const swingT=i%2===1?t0+B*0.05:t0;
          const bufSz=Math.floor(ctx.sampleRate*0.025); const hbuf=ctx.createBuffer(1,bufSz,ctx.sampleRate);
          const d=hbuf.getChannelData(0);
          for(let j=0;j<bufSz;j++) d[j]=(Math.random()*2-1)*Math.pow(1-j/bufSz,2.5);
          const src=ctx.createBufferSource(); src.buffer=hbuf;
          const hpf=ctx.createBiquadFilter(); hpf.type='highpass'; hpf.frequency.value=9000;
          const hg=ctx.createGain(); hg.gain.value=(i%4===0||i%4===2)?0.055:0.025;
          src.connect(hpf); hpf.connect(hg); hg.connect(masterGain); src.start(swingT); musicNodes.push(src);
        }
      }catch(e){}
    }
    function scheduleKick(startT,numBars){
      for(let b=0;b<numBars;b++){
        const t0=startT+b*bar;
        const o=ctx.createOscillator(); o.type='sine';
        o.frequency.setValueAtTime(90,t0); o.frequency.exponentialRampToValueAtTime(35,t0+0.09);
        const g=ctx.createGain(); g.gain.setValueAtTime(0.45,t0); g.gain.exponentialRampToValueAtTime(0.001,t0+0.12);
        o.connect(g); g.connect(masterGain); o.start(t0); o.stop(t0+0.15); musicNodes.push(o);
      }
    }
    function scheduleSnare(startT,numBars){
      for(let b=0;b<numBars;b++){
        [1,3].forEach(beat=>{
          const t0=startT+b*bar+beat*B;
          const bufSz=Math.floor(ctx.sampleRate*0.09); const sbuf=ctx.createBuffer(1,bufSz,ctx.sampleRate);
          const sd=sbuf.getChannelData(0);
          for(let j=0;j<bufSz;j++) sd[j]=(Math.random()*2-1)*Math.pow(1-j/bufSz,1.2);
          const ssrc=ctx.createBufferSource(); ssrc.buffer=sbuf;
          const bpf=ctx.createBiquadFilter(); bpf.type='bandpass'; bpf.frequency.value=2200; bpf.Q.value=0.5;
          const sg=ctx.createGain(); sg.gain.value=0.18;
          ssrc.connect(bpf); bpf.connect(sg); sg.connect(masterGain); ssrc.start(t0); musicNodes.push(ssrc);
          const so=ctx.createOscillator(); so.type='sine'; so.frequency.value=185;
          const stg=ctx.createGain(); stg.gain.setValueAtTime(0.08,t0); stg.gain.exponentialRampToValueAtTime(0.001,t0+0.05);
          so.connect(stg); stg.connect(masterGain); so.start(t0); so.stop(t0+0.06); musicNodes.push(so);
        });
      }
    }
    function scheduleBar(startT,chord,bass){
      [1,3].forEach(beat=>{ const t0=startT+beat*B; chord.forEach(freq=>noteOn(freq,t0,B*0.55,0.022/chord.length)); });
      bass.forEach((freq,i)=>noteOn(freq,startT+i*B,B*0.82,0.28,'triangle'));
      [0,2].forEach((beat,j)=>{ const t0=startT+beat*B+(j===1?B*0.05:0); noteOn(chord[chord.length-1]*(j===0?2:1.5),t0,B*0.4,0.018); });
    }
    const LOOP_BARS=chordVoicings.length;
    function scheduleLoop(startT){
      if(!musicEnabled) return;
      const loopDur=LOOP_BARS*bar;
      for(let i=0;i<LOOP_BARS;i++) scheduleBar(startT+i*bar,chordVoicings[i],bassLines[i]);
      scheduleHiHat(startT,LOOP_BARS); scheduleKick(startT,LOOP_BARS); scheduleSnare(startT,LOOP_BARS);
      musicLoopTimer=setTimeout(()=>{ if(musicEnabled) scheduleLoop(ctx.currentTime+0.15); },(loopDur-0.5)*1000);
    }
    scheduleLoop(ctx.currentTime+0.05);
  } catch(e){ console.warn('Music error:',e); }
}

function stopMusic(){
  if(musicLoopTimer){ clearTimeout(musicLoopTimer); musicLoopTimer=null; }
  musicNodes.forEach(n=>{ try{n.stop();}catch(e){} });
  musicNodes=[];
  if(musicGain){ try{musicGain.disconnect();}catch(e){} musicGain=null; }
}

function toggleSfx(){
  sfxEnabled=!sfxEnabled;
  const btn=document.getElementById('sfx-btn');
  btn.textContent=sfxEnabled?'üîä –≠—Ñ—Ñ–µ–∫—Ç—ã':'üîá –≠—Ñ—Ñ–µ–∫—Ç—ã';
  btn.style.opacity=sfxEnabled?'1':'0.5';
  if(sfxEnabled) playChipSelectSound();
}

function toggleMusic(){
  musicEnabled=!musicEnabled;
  const btn=document.getElementById('music-btn');
  btn.textContent=musicEnabled?'üéµ –ú—É–∑—ã–∫–∞':'üîï –ú—É–∑—ã–∫–∞';
  btn.style.opacity=musicEnabled?'1':'0.5';
  if(musicEnabled) startMusic();
  else stopMusic();
}

// ==================== INIT ====================
document.getElementById('betInput').addEventListener('keydown', function(e){
  if(e.key==='Enter'){
    const betAmt=getInputBet();
    if(betAmt>0&&(selectedZone||selectedBonusZone)) placeBet();
    else deal();
  }
});

updateUI();
renderRoadMapGame();
</script>

<footer class="games-footer">
  <div class="games-footer-title">–î—Ä—É–≥–∏–µ –∏–≥—Ä—ã</div>
  <div class="games-grid">
    <a href="poker.html" class="game-card-link"><span class="game-card-icon">‚ô†Ô∏è</span><span class="game-card-name">Poker</span><span class="game-card-sub">Texas Hold'em</span></a>
    <a href="roulette.html" class="game-card-link"><span class="game-card-icon">üé∞</span><span class="game-card-name">Roulette</span><span class="game-card-sub">European</span></a>
    <a href="blackjack.html" class="game-card-link"><span class="game-card-icon">‚ô£Ô∏è</span><span class="game-card-name">Blackjack</span><span class="game-card-sub">Classic 21</span></a>
  </div>
</footer>

</body>
</html>
