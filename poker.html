<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reaper Casino - Ultimate Texas Hold'em</title>
<style>
body {
    margin:0;
    font-family:"Segoe UI",Arial,sans-serif;
    background: linear-gradient(135deg,#0b0c10,#1f2833);
    color:white;
    min-height:100vh;
}

.topBar {
    position: fixed;
    top: 15px;
    right: 15px;
    display: flex;
    gap: 15px;
    background: rgba(0,0,0,0.5);
    padding: 8px 12px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    z-index: 2000;
}

.balanceDisplay {
    padding:6px 12px;
    border-radius:10px;
    background: rgba(255,255,255,0.15);
    color:white;
    font-weight:bold;
    font-size:1.1em;
}

.profileTab {
    padding:6px 12px;
    border-radius:10px;
    background: rgba(255,255,255,0.15);
    color:white;
    font-weight:bold;
    cursor:pointer;
    transition:0.2s;
}
.profileTab:hover { background: rgba(255,255,255,0.3); }

#addFundsBtn {
    position:fixed;
    right:15px;
    bottom:15px;
    padding:10px 20px;
    border:none;
    border-radius:10px;
    background:#28a745;
    color:white;
    font-weight:bold;
    cursor:pointer;
}

.profileModal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    z-index: 2000;
    justify-content: center;
    align-items: center;
}

.player-combo, .dealer-combo {
    font-size: clamp(1.3rem, 4vw, 1.8rem);
    font-weight: bold;
    margin-top: 12px;
    min-height: 1.5em;
    color: white;
    text-shadow: 0 2px 6px rgba(0,0,0,0.7);
}

.player-combo.better { color: #34d399; }
.player-combo.worse  { color: #f87171; }
.player-combo.tie    { color: #fbbf24; }

button {
    font-size: clamp(0.95rem, 3.5vw, 1.1em);
    padding: clamp(10px, 3vw, 12px) clamp(18px, 5vw, 24px);
    border-radius: 10px;
    margin: 6px;
    cursor: pointer;
    background: #ff4b2b;
    color: white;
    font-weight: bold;
    touch-action: manipulation;
}

input[type="number"] {
    font-size: clamp(1rem, 3.5vw, 1.1em);
    padding: 10px;
    border-radius: 10px;
    border: 2px solid #444;
    background: #1a1a1a;
    color: white;
    text-align: center;
    width: clamp(110px, 30vw, 140px);
    margin: 6px;
}

#actionButtons { 
    text-align: center; 
    margin: 20px 0; 
    min-height: 70px; 
}

#playerWinText { 
    font-size: clamp(1.2rem, 4vw, 1.4em); 
    margin: 15px 0; 
    text-align: center; 
    font-weight: bold; 
}

#totalStakeDisplay {
    text-align: center;
    font-size: clamp(1.1rem, 3.8vw, 1.3em);
    margin: 12px 0 4px;
    color: #fbbf24;
    font-weight: bold;
}

.profileContent {
    background: #1f2833;
    padding: 30px;
    border-radius: 15px;
    width: 340px;
    max-width: 90%;
    text-align: center;
    position: relative;
    box-shadow: 0 10px 30px rgba(0,0,0,0.7);
}

.profileContent h2 { color: #ffb347; margin-bottom: 24px; }

.profileContent p {
    margin: 14px 0;
    font-size: 1.1em;
    display: flex;
    justify-content: space-between;
}

.profileContent .value { font-weight: bold; color: #e0e0e0; }

.closeProfile {
    position: absolute;
    top: 12px;
    right: 18px;
    font-size: 28px;
    color: #ff4b2b;
    cursor: pointer;
}

.resetStatsBtn {
    margin-top: 24px;
    padding: 12px 30px;
    background: #28a745;
    color: white;
    border: none;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
}

header {
    padding: 80px 15px 20px;
    text-align: center;
}

.welcome {
    font-size: 48px;
    font-weight: bold;
    color: #ff4b2b;
    text-shadow: 2px 2px 15px rgba(255,75,43,0.6);
}
.welcome span { color: #ffb347; }

.main-container {
    display: flex;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 15px;
    gap: 25px;
    flex-wrap: wrap;
}

.sidebar {
    width: 180px;
    flex-shrink: 0;
    margin-top: 100px;
}

.sidebar a {
    display: block;
    padding: 12px 16px;
    margin-bottom: 10px;
    border-radius: 10px;
    background: #444;
    color: white;
    text-decoration: none;
    font-weight: bold;
    text-align: center;
}

.gameWrapper {
    flex: 1 1 500px;
    background: rgba(0,0,0,0.5);
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.6);
}

.cardsSection {
    margin: 25px 0;
    text-align: center;
}

.cardsContainer {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
    margin: 15px 0;
}

/* –ù–û–í–´–ô –î–ò–ó–ê–ô–ù –ö–ê–†–¢ ‚Äî –±–µ–ª—ã–µ –ª–∏—Ü–µ–≤—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã */
.card {
    width: 90px;
    height: 130px;
    border-radius: 12px;
    background: white; /* –±–µ–ª—ã–π —Ñ–æ–Ω */
    color: #000;
    box-shadow: 0 10px 25px rgba(0,0,0,0.8), inset 0 1px 6px rgba(0,0,0,0.1);
    position: relative;
    overflow: hidden;
    opacity: 0;
    transform: translateY(30px) scale(0.94);
    transition: all 0.5s ease;
}

.card.show {
    opacity: 1;
    transform: translateY(0) scale(1);
}

.card .corner {
    position: absolute;
    font-size: 20px;
    font-weight: bold;
    padding: 8px;
    line-height: 1;
}

.card .top-left { top: 6px; left: 6px; }
.card .bottom-right { bottom: 6px; right: 6px; transform: rotate(180deg); }

.card .center {
    position: absolute;
    inset: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 54px;
    font-weight: bold;
}

/* –ö—Ä–∞—Å–Ω—ã–µ –º–∞—Å—Ç–∏ */
.card.red { color: #c00; }

/* –ù–æ–≤–∞—è —Ä—É–±–∞—à–∫–∞ –∫–∞—Ä—Ç */
.card.back {
    background: linear-gradient(135deg, #0d1b2a 0%, #1b263b 50%, #0d1b2a 100%);
    border: 2px solid #415a77;
    color: #e0e1dd;
    position: relative;
    overflow: hidden;
}

.card.back::before {
    content: "REAPER CASINO";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(-35deg);
    font-size: 20px;
    font-weight: bold;
    color: rgba(229, 225, 221, 0.15);
    letter-spacing: 4px;
    white-space: nowrap;
    pointer-events: none;
}

.card.back::after {
    content: "‚ô† ‚ô• ‚ô¶ ‚ô£";
    position: absolute;
    bottom: 8px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 16px;
    color: rgba(229, 225, 221, 0.25);
    letter-spacing: 8px;
}

/* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ (player-combo, actionButtons –∏ —Ç.–¥.) –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
.player-combo, .dealer-combo {
    font-size: 1.8em;
    font-weight: bold;
    margin-top: 14px;
    min-height: 1.5em;
    letter-spacing: 0.5px;
    color: white;
    text-shadow: 0 2px 6px rgba(0,0,0,0.7);
}

.player-combo.better { color: #34d399; text-shadow: 0 0 12px #34d39980; }
.player-combo.worse  { color: #f87171; text-shadow: 0 0 12px #f8717180; }
.player-combo.tie    { color: #fbbf24; text-shadow: 0 0 12px #fbbf2480; }
button {
    font-size:1.1em;
    padding:12px 24px;
    border-radius:10px;
    border:none;
    margin:8px;
    cursor:pointer;
    background:#ff4b2b;
    color:white;
    font-weight:bold;
    transition: background 0.2s;
}

button:hover { background: #e03e20; }

input[type="number"] {
    font-size:1em;
    padding:12px;
    border-radius:12px;
    border:2px solid #444;
    background:#1a1a1a;
    color:white;
    text-align:center;
    width: 140px;
    margin: 8px;
}

#actionButtons { text-align:center; margin:25px 0; min-height:80px; }

#playerWinText { font-size:1.4em; margin:20px 0; text-align:center; font-weight:bold; }

#totalStakeDisplay {
    text-align: center;
    font-size: 1.3em;
    margin: 15px 0 5px;
    color: #fbbf24;
    font-weight: bold;
}
.bonus-table-wrapper {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}

.bonus-table-wrapper table {
    width: 100%;
    min-width: 240px;
    font-size: clamp(0.85rem, 3vw, 0.95em);
}
@media (max-width: 600px) {
    .gameWrapper { padding: 15px; }
    .cardsContainer { gap: 6px; }
    .card { width: 68px; height: 102px; }
    .card .center { font-size: 38px; }
    .player-combo, .dealer-combo { font-size: 1.3rem; }
    button { padding: 10px 16px; font-size: 0.95rem; }
    input[type="number"] { width: 110px; font-size: 0.95rem; }
    header { padding-top: 60px; }
    .welcome { font-size: 2.8rem; }
}
</style>
</head>
<body>

<div class="topBar">
    <div class="balanceDisplay">–ë–∞–ª–∞–Ω—Å: <span id="casinoBalance">10000</span></div>
    <div class="profileTab" onclick="toggleProfile()">–ü—Ä–æ—Ñ–∏–ª—å üìä</div>
</div>
<header>
    <div class="welcome">Reaper<span> Casino</span></div>
</header>

<div class="main-container">
    <div class="sidebar" id="sidebar">
        <a href="blackjack.html">üÇ° Blackjack</a>
        <a href="roulette.html">üé° –†—É–ª–µ—Ç–∫–∞</a>
        <a href="index.html">üè† –ì–ª–∞–≤–Ω–∞—è</a>
    </div>

    <div class="gameWrapper">
        <div style="text-align:center; margin-bottom:20px;">
            <input type="number" id="bbBet" placeholder="BB / Ante" min="1">
            <input type="number" id="tripsBet" placeholder="Trips" min="0">
            <input type="number" id="ultimateBet" placeholder="Ultimate" min="0">
            <button id="startBtn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        </div>

        <div class="cardsSection">
            <h3>–í–∞—à–∏ –∫–∞—Ä—Ç—ã</h3>
            <div class="cardsContainer" id="playerCards"></div>
            <div id="playerCombo" class="player-combo"></div>
        </div>

        <div class="cardsSection">
            <h3>–ö–∞—Ä—Ç—ã –¥–∏–ª–µ—Ä–∞</h3>
            <div class="cardsContainer" id="botCards"></div>
            <div id="dealerCombo" class="dealer-combo"></div>
        </div>

        <div class="cardsSection">
            <h3>–°—Ç–æ–ª</h3>
            <div class="cardsContainer" id="tableCards"></div>
        </div>

        <div id="actionButtons"></div>
        <p id="playerWinText"></p>

        <p id="totalStakeDisplay">–û–±—â–∞—è —Å—Ç–∞–≤–∫–∞: 0</p>

        <div style="text-align:center; font-size:1.2em; margin-top:15px;">
            –ë–∞–ª–∞–Ω—Å: <span id="casinoBalanceBottom">10000</span>
        </div>
    </div>

    <div style="flex: 0 0 300px; display:flex; flex-direction:column; gap:20px;">
        <div style="background:rgba(255,255,255,0.05); border-radius:12px; padding:15px;">
            <h3 style="text-align:center; color:#ffb347; margin-bottom:12px;">Trips Bonus</h3>
            <table style="width:100%; border-collapse:collapse; font-size:0.95em;">
                <tr><th>–ö–æ–º–±–∏–Ω–∞—Ü–∏—è</th><th>–í—ã–ø–ª–∞—Ç–∞</th></tr>
                <tr><td>–°–µ—Ç</td><td>3:1</td></tr>
                <tr><td>–°—Ç—Ä–∏—Ç</td><td>5:1</td></tr>
                <tr><td>–§–ª–µ—à</td><td>7:1</td></tr>
                <tr><td>–§—É–ª–ª-—Ö–∞—É—Å</td><td>10:1</td></tr>
                <tr><td>–ö–∞—Ä–µ</td><td>25:1</td></tr>
                <tr><td>–°—Ç—Ä–∏—Ç-—Ñ–ª–µ—à</td><td>40:1</td></tr>
                <tr><td>–†–æ—è–ª-—Ñ–ª–µ—à</td><td>70:1</td></tr>
            </table>
        </div>

        <div style="background:rgba(255,255,255,0.05); border-radius:12px; padding:15px;">
            <h3 style="text-align:center; color:#ffb347; margin-bottom:12px;">Ultimate Bonus</h3>
            <table style="width:100%; border-collapse:collapse; font-size:0.95em;">
                <tr><th>–ö–æ–º–±–∏–Ω–∞—Ü–∏—è</th><th>–í—ã–ø–ª–∞—Ç–∞</th></tr>
                <tr><td>AA</td><td>30x</td></tr>
                <tr><td>AK suited</td><td>25x</td></tr>
                <tr><td>AQ suited</td><td>20x</td></tr>
                <tr><td>AJ suited</td><td>15x</td></tr>
                <tr><td>KK / QQ / JJ</td><td>15x</td></tr>
                <tr><td>AK off-suited</td><td>10x</td></tr>
                <tr><td>AQ off-suited</td><td>5x</td></tr>
                <tr><td>AJ off-suited</td><td>2x</td></tr>
            </table>
        </div>
    </div>
</div>

<div id="profileModal" class="profileModal">
    <div class="profileContent">
        <span class="closeProfile" onclick="toggleProfile()">‚úñ</span>
        <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ Ultimate Texas Hold'em</h2>
        <p>–í—Å–µ–≥–æ –∏–≥—Ä: <span class="value" id="statGames">0</span></p>
        <p>–í—ã–∏–≥—Ä—ã—à–µ–π: <span class="value" id="statWins">0</span></p>
        <p>–ü—Ä–æ–∏–≥—Ä—ã—à–µ–π: <span class="value" id="statLosses">0</span></p>
        <p>–ú–∞–∫—Å. –≤—ã–ø–ª–∞—Ç–∞: <span class="value" id="statMaxWin">0</span></p>
        <p>–õ—É—á—à–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è: <span class="value" id="statBestCombo">-</span></p>
        <button class="resetStatsBtn" onclick="resetStats()">–°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
    </div>
</div>

<button id="addFundsBtn">+10000</button>

<script>
// –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∞–ª–∞–Ω—Å —Å—Ä–∞–∑—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
let casinoBalance = localStorage.getItem("casinoBalance") 
    ? parseInt(localStorage.getItem("casinoBalance")) 
    : 10000;

// –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ä–∞–∑—É
updateCasinoBalance();

// –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ –¥—Ä—É–≥–∏—Ö –≤–∫–ª–∞–¥–æ–∫/–∏–≥—Ä
window.addEventListener('storage', (e) => {
    if (e.key === "casinoBalance") {
        casinoBalance = e.newValue ? parseInt(e.newValue) : 10000;
        updateCasinoBalance();
    }
});

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ (–∏ –≤ topBar, –∏ –≤–Ω–∏–∑—É)
function updateCasinoBalance() {
    const balStr = casinoBalance.toLocaleString('ru-RU');
    document.getElementById("casinoBalance").innerText = balStr;
    document.getElementById("casinoBalanceBottom").innerText = balStr;
    localStorage.setItem("casinoBalance", casinoBalance);
}

// –ö–Ω–æ–ø–∫–∞ +10000 (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ localStorage)
document.getElementById("addFundsBtn").onclick = () => {
    casinoBalance += 10000;
    updateCasinoBalance();
};

let pokerStats = localStorage.getItem("pokerStats") 
    ? JSON.parse(localStorage.getItem("pokerStats")) 
    : {games:0, wins:0, losses:0, maxWin:0, bestCombo:"-"};

function toggleProfile() {
    const modal = document.getElementById("profileModal");
    modal.style.display = modal.style.display === "flex" ? "none" : "flex";
    if (modal.style.display === "flex") {
        document.getElementById("statGames").innerText = pokerStats.games || 0;
        document.getElementById("statWins").innerText = pokerStats.wins || 0;
        document.getElementById("statLosses").innerText = pokerStats.losses || 0;
        document.getElementById("statMaxWin").innerText = pokerStats.maxWin || 0;
        document.getElementById("statBestCombo").innerText = pokerStats.bestCombo || "-";
    }
}

function resetStats() {
    if (!confirm("–°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É?")) return;
    pokerStats = {games:0, wins:0, losses:0, maxWin:0, bestCombo:"-"};
    localStorage.setItem("pokerStats", JSON.stringify(pokerStats));
    toggleProfile();
}

let deck = [], player = [], bot = [], flop = [], turn = [], river = [];
let bbBet = 0, anteBet = 0, tripsBet = 0, ultimateBet = 0;
let stage = "", currentPlayBet = 0;

const suits = ["‚ô†","‚ô•","‚ô¶","‚ô£"];
const ranks = ["2","3","4","5","6","7","8","9","10","J","Q","K","A"];

document.getElementById("startBtn").onclick = startPoker;

function createDeck(){
    let d = []; 
    for(let s of suits) for(let r of ranks) d.push(r+s); 
    return d.sort(()=>Math.random()-0.5);
}

function deal(n){ return deck.splice(0,n); }

function displayCards(id, cards){
    const container = document.getElementById(id); 
    container.innerHTML = "";
    cards.forEach((card, i) => {
        const div = document.createElement("div");
        div.classList.add("card");
        if(card==="üÇ†"){ 
            div.classList.add("back"); 
        } else {
            const rank = card.slice(0,-1), suit = card.slice(-1);
            if(suit==="‚ô•"||suit==="‚ô¶") div.classList.add("red"); else div.classList.add("black");
            div.innerHTML = `
                <div class="corner top-left">${rank}<br>${suit}</div>
                <div class="center">${suit}</div>
                <div class="corner bottom-right">${rank}<br>${suit}</div>
            `;
        }
        container.appendChild(div);
        setTimeout(() => div.classList.add("show"), 100 + i * 120);
    });
}

function evaluateHand(cards) {
    const values = cards.map(c => ranks.indexOf(c.slice(0,-1))).sort((a,b)=>b-a);
    const suitsArr = cards.map(c => c.slice(-1));
    const count = {};
    values.forEach(v => count[v] = (count[v] || 0) + 1);

    const flushSuit = suitsArr.find(s => suitsArr.filter(x=>x===s).length >= 5);
    const flushCards = flushSuit ? cards.filter(c=>c.slice(-1)===flushSuit) : [];
    const flushValues = flushCards.map(c=>ranks.indexOf(c.slice(0,-1))).sort((a,b)=>b-a);

    const pairs = Object.keys(count).filter(k=>count[k]===2).map(Number).sort((a,b)=>b-a);
    const three = Object.keys(count).filter(k=>count[k]===3).map(Number);
    const four = Object.keys(count).filter(k=>count[k]===4).map(Number);

    function getStraight(vals) {
        vals = [...new Set(vals)].sort((a,b)=>b-a);
        for (let i = 0; i <= vals.length - 5; i++) {
            if (vals[i] - vals[i+4] === 4) return vals[i];
        }
        if (vals.includes(12) && vals.includes(3) && vals.includes(2) && vals.includes(1) && vals.includes(0)) return 3;
        return null;
    }

    const straightHigh = getStraight(values);
    let sfHigh = null;
    if (flushSuit) sfHigh = getStraight(flushValues);

    let result = {score:0, name:"–°—Ç–∞—Ä—à–∞—è –∫–∞—Ä—Ç–∞", ranks:values.slice(0,5)};

    if (sfHigh === 12) result = {score:9, name:"–†–æ—è–ª-—Ñ–ª–µ—à", ranks:flushValues.slice(0,5)};
    else if (sfHigh !== null) result = {score:8, name:"–°—Ç—Ä–∏—Ç-—Ñ–ª–µ—à", ranks:flushValues.slice(0,5)};
    else if (four.length) result = {score:7, name:"–ö–∞—Ä–µ", ranks:[four[0], ...values.filter(v=>v!==four[0]).slice(0,4)]};
    else if (three.length && pairs.length) result = {score:6, name:"–§—É–ª–ª-—Ö–∞—É—Å", ranks:[three[0], pairs[0]]};
    else if (flushSuit) result = {score:5, name:"–§–ª–µ—à", ranks:flushValues.slice(0,5)};
    else if (straightHigh !== null) result = {score:4, name:"–°—Ç—Ä–∏—Ç", ranks:values.slice(0,5)};
    else if (three.length) result = {score:3, name:"–°–µ—Ç", ranks:[three[0], ...values.filter(v=>v!==three[0]).slice(0,4)]};
    else if (pairs.length >= 2) result = {score:2, name:"–î–≤–µ –ø–∞—Ä—ã", ranks:[pairs[0], pairs[1], ...values.filter(r => r !== pairs[0] && r !== pairs[1]).slice(0,3)]};
    else if (pairs.length === 1) result = {score:1, name:"–ü–∞—Ä–∞", ranks:[pairs[0], ...values.filter(r => r !== pairs[0]).slice(0,4)]};
    else result = {score:0, name:"–°—Ç–∞—Ä—à–∞—è –∫–∞—Ä—Ç–∞", ranks:values.slice(0,5)};

    return result;
}

function compareHands(p, d){
    if(p.score !== d.score) return p.score > d.score ? 1 : -1;
    for(let i=0; i<Math.min(p.ranks.length, d.ranks.length); i++){
        if(p.ranks[i] !== d.ranks[i]) return p.ranks[i] > d.ranks[i] ? 1 : -1;
    }
    return 0;
}

function updatePlayerCombo(show = false) {
    const el = document.getElementById("playerCombo");
    if (!show) {
        el.textContent = "";
        el.className = "player-combo";
        return;
    }

    let currentCards = [...player];
    if (flop.length) currentCards = currentCards.concat(flop);
    if (turn.length) currentCards = currentCards.concat(turn);
    if (river.length) currentCards = currentCards.concat(river);

    const eval = evaluateHand(currentCards);
    el.textContent = eval.name;
    el.className = "player-combo"; // –±—É–¥–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –≤ finishPoker
}

function updateTotalStake() {
    const total = (bbBet * 2) + tripsBet + ultimateBet + currentPlayBet;
    document.getElementById("totalStakeDisplay").textContent = `–û–±—â–∞—è —Å—Ç–∞–≤–∫–∞: ${total}`;
}

function startPoker(){
    document.getElementById("playerCombo").textContent = "";
    document.getElementById("playerCombo").className = "player-combo";
    document.getElementById("dealerCombo").textContent = "";
    document.getElementById("dealerCombo").className = "dealer-combo";

    document.getElementById("playerWinText").innerText = "";
    document.getElementById("actionButtons").innerHTML = "";

    bbBet = parseInt(document.getElementById("bbBet").value) || 0;
    anteBet = bbBet;
    tripsBet = parseInt(document.getElementById("tripsBet").value) || 0;
    ultimateBet = parseInt(document.getElementById("ultimateBet").value) || 0;

    lastBB = bbBet;
    lastTrips = tripsBet;
    lastUltimate = ultimateBet;

    const totalCost = bbBet * 2 + tripsBet + ultimateBet;

    if (bbBet < 1) {
        alert("BB / Ante –º–∏–Ω–∏–º—É–º 1");
        return;
    }
    if (casinoBalance < totalCost) {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");
        return;
    }

    casinoBalance -= totalCost;
    updateCasinoBalance();
    updateTotalStake();

    deck = createDeck();
    player = deal(2);
    bot = deal(2);
    flop = []; turn = []; river = [];

    displayCards("playerCards", player);
    displayCards("botCards", ["üÇ†","üÇ†"]);
    displayCards("tableCards", []);

    updatePlayerCombo(false); // –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
    updateTotalStake();

    stage = "preflop";
    currentPlayBet = 0;

    showButtons("–ü—Ä–µ—Ñ–ª–æ–ø: 4√ó –∏–ª–∏ —á–µ–∫", 4, false, true);
}

function showButtons(text, mult, allowFold = false, showCheck = true) {
    const div = document.getElementById("actionButtons");
    div.innerHTML = `<p style="margin:10px 0;">${text}</p>`;
    
    if (mult > 0) {
        const btn = document.createElement("button");
        btn.textContent = `–°—Ç–∞–≤–∫–∞ ${mult}√ó`;
        btn.onclick = () => playerMove(mult);
        div.appendChild(btn);
    }
    
    if (showCheck) {
        const btn = document.createElement("button");
        btn.textContent = "–ß–µ–∫";
        btn.onclick = () => playerMove(0);
        div.appendChild(btn);
    }
    
    if (allowFold) {
        const btn = document.createElement("button");
        btn.textContent = "–§–æ–ª–¥";
        btn.onclick = foldPoker;
        div.appendChild(btn);
    }
}

function playerMove(mult) {
    if (mult > 0) {
        const stake = bbBet * mult;
        if (stake > casinoBalance) {
            alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");
            return;
        }
        casinoBalance -= stake;
        updateCasinoBalance();
        currentPlayBet += stake;
        updateTotalStake();
    }

    if (stage === "preflop") {
        if (mult === 4) {
            deal(3); flop = deal(3);
            deal(1); turn = deal(1);
            deal(1); river = deal(1);
            stage = "showdown";
            displayCards("tableCards", flop.concat(turn, river));
            updatePlayerCombo(true);
            finishPoker();
            return;
        }
        stage = "flop";
        deal(3); flop = deal(3);
        displayCards("tableCards", flop);
        showButtons("–§–ª–æ–ø: 2√ó –∏–ª–∏ —á–µ–∫", 2, false, true);
    } else if (stage === "flop") {
        if (mult === 2) {
            deal(1); turn = deal(1);
            deal(1); river = deal(1);
            stage = "showdown";
            displayCards("tableCards", flop.concat(turn, river));
            updatePlayerCombo(true);
            finishPoker();
            return;
        }
        stage = "turn_river";
        deal(1); turn = deal(1);
        deal(1); river = deal(1);
        displayCards("tableCards", flop.concat(turn, river));
        showButtons("–¢–µ—Ä–Ω/–†–∏–≤–µ—Ä: 1√ó –∏–ª–∏ —Ñ–æ–ª–¥", 1, true, false);
    } else if (stage === "turn_river") {
        stage = "showdown";
        updatePlayerCombo(true);
        finishPoker();
    }
}

function foldPoker() {
    displayCards("botCards", bot);

    if (flop.length === 0) {
        deal(3); flop = deal(3);
    }
    if (turn.length === 0) {
        deal(1); turn = deal(1);
        deal(1); river = deal(1);
    }
    displayCards("tableCards", flop.concat(turn, river));

    const dealerHand = [...bot, ...flop, ...turn, ...river];
    const dealerEval = evaluateHand(dealerHand);
    document.getElementById("dealerCombo").textContent = dealerEval.name;
    document.getElementById("dealerCombo").className = "dealer-combo better";

    updatePlayerCombo(true);

    document.getElementById("playerWinText").style.color = "#f87171";
    document.getElementById("playerWinText").innerText = "–í—ã —Å–±—Ä–æ—Å–∏–ª–∏ –∫–∞—Ä—Ç—ã ‚Äî –ø–æ—Ç–µ—Ä–∏: Ante + BB + Play";
    document.getElementById("actionButtons").innerHTML = "";
    setTimeout(showRestartButton, 300);
}

function finishPoker(){
    displayCards("botCards", bot);

    const playerHand = [...player, ...flop, ...turn, ...river];
    const dealerHand = [...bot, ...flop, ...turn, ...river];

    const playerEval = evaluateHand(playerHand);
    const dealerEval = evaluateHand(dealerHand);

    const cmp = compareHands(playerEval, dealerEval);
    const playerWins = cmp > 0;
    const tie = cmp === 0;
    const dealerQualified = dealerEval.score >= 1;

    const playerComboEl = document.getElementById("playerCombo");
    const dealerComboEl = document.getElementById("dealerCombo");

    playerComboEl.textContent = playerEval.name;
    dealerComboEl.textContent = dealerEval.name;

    playerComboEl.className = "player-combo";
    dealerComboEl.className = "dealer-combo";

    if (cmp > 0) {
        playerComboEl.classList.add("better");
        dealerComboEl.classList.add("worse");
    } else if (cmp < 0) {
        playerComboEl.classList.add("worse");
        dealerComboEl.classList.add("better");
    } else {
        playerComboEl.classList.add("tie");
        dealerComboEl.classList.add("tie");
    }

    let totalWin = 0;
    let messages = [];

    if (playerWins) {
        totalWin += currentPlayBet;
        messages.push("Play 1:1");
    } else if (tie) {
        totalWin += currentPlayBet;
        messages.push("Play push");
    }

    if (tie || !dealerQualified) {
        totalWin += anteBet;
        messages.push("Ante push");
    } else if (playerWins) {
        totalWin += anteBet;
        messages.push("Ante 1:1");
    }

    if (tie) {
        totalWin += bbBet;
        messages.push("Blind push");
    } else if (playerWins) {
        const blindMult = {
            "–°—Ç—Ä–∏—Ç":1, "–§–ª–µ—à":2, "–§—É–ª–ª-—Ö–∞—É—Å":3, "–ö–∞—Ä–µ":10,
            "–°—Ç—Ä–∏—Ç-—Ñ–ª–µ—à":50, "–†–æ—è–ª-—Ñ–ª–µ—à":500
        }[playerEval.name] || 0;
        if (blindMult > 0) {
            totalWin += bbBet * (blindMult + 1);
            messages.push(`Blind ${blindMult+1}:1`);
        } else {
            totalWin += bbBet;
            messages.push("Blind push");
        }
    }

    const tripsMult = {
        "–°–µ—Ç":3, "–°—Ç—Ä–∏—Ç":5, "–§–ª–µ—à":7, "–§—É–ª–ª-—Ö–∞—É—Å":10,
        "–ö–∞—Ä–µ":25, "–°—Ç—Ä–∏—Ç-—Ñ–ª–µ—à":40, "–†–æ—è–ª-—Ñ–ª–µ—à":70
    }[playerEval.name] || 0;
    if (tripsBet > 0 && tripsMult > 0) {
        totalWin += tripsBet * (tripsMult + 1);
        messages.push(`Trips ${tripsMult+1}:1`);
    }

    const ultMult = evaluateUltimate(player);
    if (ultimateBet > 0 && ultMult > 0) {
        totalWin += ultimateBet * ultMult;
        messages.push(`Ultimate ${ultMult}x`);
    }

    casinoBalance += totalWin;
    updateCasinoBalance();

    const winEl = document.getElementById("playerWinText");
    if (totalWin > 0) {
        winEl.style.color = "#34d399";
        winEl.innerText = `–í—ã–∏–≥—Ä—ã—à: ${totalWin} | ${messages.join(" | ")}`;
    } else if (tie) {
        winEl.style.color = "#fbbf24";
        winEl.innerText = `–ù–∏—á—å—è | ${messages.join(" | ")}`;
    } else {
        winEl.style.color = "#f87171";
        winEl.innerText = `–ü—Ä–æ–∏–≥—Ä—ã—à`;
    }

    pokerStats.games += 1;
    if (playerWins) pokerStats.wins += 1;
    else if (!tie) pokerStats.losses += 1;
    if (totalWin > pokerStats.maxWin) pokerStats.maxWin = totalWin;
    if (playerEval.score > 0 && playerEval.name !== pokerStats.bestCombo) {
        pokerStats.bestCombo = playerEval.name;
    }
    localStorage.setItem("pokerStats", JSON.stringify(pokerStats));

    setTimeout(showRestartButton, 800);
}

function evaluateUltimate(cards) {
    const [c1, c2] = cards;
    const r1 = c1.slice(0,-1), s1 = c1.slice(-1);
    const r2 = c2.slice(0,-1), s2 = c2.slice(-1);

    if (r1 === "A" && r2 === "A") return 30;
    if (r1 === r2 && ["K","Q","J"].includes(r1)) return 15;
    if ((r1==="A" && r2==="K" || r1==="K" && r2==="A") && s1===s2) return 25;
    if ((r1==="A" && r2==="Q" || r1==="Q" && r2==="A") && s1===s2) return 20;
    if ((r1==="A" && r2==="J" || r1==="J" && r2==="A") && s1===s2) return 15;
    if ((r1==="A" && r2==="K" || r1==="K" && r2==="A")) return 10;
    if ((r1==="A" && r2==="Q" || r1==="Q" && r2==="A")) return 5;
    if ((r1==="A" && r2==="J" || r1==="J" && r2==="A")) return 2;
    return 0;
}

function showRestartButton() {
    const div = document.getElementById("actionButtons");
    div.innerHTML = "";
    const btn = document.createElement("button");
    btn.textContent = "–ù–æ–≤–∞—è –∏–≥—Ä–∞";
    btn.onclick = () => {
        document.getElementById("playerCombo").textContent = "";
        document.getElementById("playerCombo").className = "player-combo";
        document.getElementById("dealerCombo").textContent = "";
        document.getElementById("dealerCombo").className = "dealer-combo";

        document.getElementById("playerWinText").innerText = "";
        document.getElementById("playerCards").innerHTML = "";
        document.getElementById("botCards").innerHTML = "";
        document.getElementById("tableCards").innerHTML = "";
        document.getElementById("actionButtons").innerHTML = "";

        document.getElementById("bbBet").value = lastBB || "";
        document.getElementById("tripsBet").value = lastTrips || "";
        document.getElementById("ultimateBet").value = lastUltimate || "";

        updateTotalStake();
        startPoker();
    };
    div.appendChild(btn);
}
</script>
</body>
</html>
